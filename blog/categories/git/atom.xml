<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: git | blog.dm4.tw]]></title>
  <link href="http://blog.dm4.tw/blog/categories/git/atom.xml" rel="self"/>
  <link href="http://blog.dm4.tw/"/>
  <updated>2015-04-20T01:02:04+08:00</updated>
  <id>http://blog.dm4.tw/</id>
  <author>
    <name><![CDATA[dm4]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[更改 git commit 時間]]></title>
    <link href="http://blog.dm4.tw/blog/2015/04/19/modify-git-commit-time/"/>
    <updated>2015-04-19T22:38:00+08:00</updated>
    <id>http://blog.dm4.tw/blog/2015/04/19/modify-git-commit-time</id>
    <content type="html"><![CDATA[<p>最近剛好需要更改 git repo 的 commit time ，研究了一下順便把它記錄下來。</p>

<p>首先需要知道的是，在 git 裡，因為 commit 是可以被修改的，在一個 commit 裡其實會記錄 <strong>author</strong> 和 <strong>committer</strong> ， <strong>author</strong> 就是寫 code 的人， <strong>committer</strong> 則是真正提交 code 的人，</p>

<p>用法大概是：對某個你不是 maintainer 的 project ，你寫了一個新功能，然後用 <code>git format-patch</code> 生出了 patch ，接著你把這個 patch 送給 maintainer ，在 maintainer 決定採用你的 patch 之後，用 <code>git apply</code> 來採用你的 commit ，接著他再 <code>git commit</code> ， code 才進到 repo 裡，這個新 commit 的 <strong>author</strong> 就是你， <strong>committer</strong> 就是真的做 <code>git commit</code> 的那個 maintainer 。</p>

<p>為什麼改 commit 時間，會要知道 git 裡的 author 和 committer 呢？因為在更改 commit 時間時，如果沒有特別注意的話，會只改到 commit time ，並且該 commit 的 committer 會變成自己，原本的 author 資訊和 author time 會保留下來，所以如果不想讓人發現曾經改過 commit 的話，必須把 committer 設成原本的 author ，也要把 author time 改成想要的 commit time 。</p>

<p>知道這些之後大概就沒問題了，可以用 <code>git filter-branch</code> (<a href="http://git-scm.com/docs/git-filter-branch">http://git-scm.com/docs/git-filter-branch</a>) 來做：</p>

<h2>Script &amp; Setup</h2>

<p>```
[~/modify-commit-time] ➟  ls
modify_commit_time.sh*
[~/modify-commit-time] ➟  cat modify_commit_time.sh</p>

<h1>clear previous backup</h1>

<p>rm -rf &ldquo;$(git rev-parse &mdash;git-dir)/refs/original/&rdquo;</p>

<p>commit=&ldquo;$1&rdquo;
date=$(date -d &ldquo;$2&rdquo; +%s)
git filter-branch &mdash;env-filter \</p>

<pre><code>"if [ \$GIT_COMMIT = '$commit' ]; then
     export GIT_AUTHOR_DATE='$date'
     export GIT_COMMITTER_DATE='$date'
     export GIT_COMMITTER_NAME="\$GIT_AUTHOR_NAME"
     export GIT_COMMITTER_EMAIL="\$GIT_AUTHOR_EMAIL"
 fi"
</code></pre>

<p>[~/modify-commit-time] ➟  git init
Initialized empty Git repository in /home/dm4/modify-commit-time/.git/
(master) [~/modify-commit-time] ➟  git add modify_commit_time.sh
(master) [~/modify-commit-time] ➟  git commit -m &lsquo;add script&rsquo;
[master (root-commit) 9c4c1d0] add script
 1 file changed, 12 insertions(+)
 create mode 100755 modify_commit_time.sh
(master) [~/modify-commit-time] ➟  echo &lsquo;# Hello&rsquo; > README.md
(master) [~/modify-commit-time] ➟  git add README.md
(master) [~/modify-commit-time] ➟  git commit -m &lsquo;add README&rsquo;
[master a2913a7] add README
 1 file changed, 1 insertion(+)
 create mode 100644 README.md
```</p>

<p>可以看到現在有兩個 commit</p>

<p>```
(master) [~/modify-commit-time] ➟  git log &mdash;pretty=fuller
commit a2913a7c39977dd3c4f99f8cabc6fae5b3694cb2
Author:     dm4 <a href="&#x6d;&#x61;&#x69;&#108;&#x74;&#111;&#x3a;&#116;&#x65;&#x73;&#x74;&#x40;&#x65;&#x78;&#97;&#109;&#x70;&#108;&#x65;&#46;&#x63;&#111;&#109;">&#x74;&#101;&#x73;&#116;&#x40;&#x65;&#x78;&#97;&#109;&#112;&#108;&#101;&#46;&#99;&#111;&#109;</a>
AuthorDate: Sun Apr 19 16:48:33 2015 +0000
Commit:     dm4 <a href="&#x6d;&#x61;&#105;&#108;&#116;&#x6f;&#58;&#116;&#101;&#x73;&#116;&#64;&#101;&#120;&#97;&#109;&#112;&#x6c;&#101;&#x2e;&#99;&#x6f;&#109;">&#x74;&#x65;&#115;&#x74;&#x40;&#101;&#x78;&#97;&#x6d;&#112;&#108;&#101;&#x2e;&#x63;&#111;&#x6d;</a>
CommitDate: Sun Apr 19 16:48:33 2015 +0000</p>

<pre><code>add README
</code></pre>

<p>commit 9c4c1d0b4499683ab0ba80dd7041b477c0adb2f0
Author:     dm4 <a href="&#x6d;&#x61;&#x69;&#x6c;&#116;&#x6f;&#x3a;&#116;&#101;&#115;&#116;&#x40;&#x65;&#x78;&#x61;&#109;&#112;&#x6c;&#x65;&#46;&#x63;&#x6f;&#109;">&#x74;&#x65;&#115;&#x74;&#64;&#x65;&#x78;&#97;&#109;&#x70;&#x6c;&#x65;&#x2e;&#x63;&#111;&#x6d;</a>
AuthorDate: Sun Apr 19 16:48:33 2015 +0000
Commit:     dm4 <a href="&#x6d;&#97;&#x69;&#108;&#x74;&#111;&#58;&#x74;&#101;&#x73;&#x74;&#64;&#x65;&#120;&#97;&#109;&#x70;&#108;&#x65;&#46;&#x63;&#111;&#109;">&#x74;&#x65;&#x73;&#116;&#64;&#101;&#120;&#x61;&#x6d;&#x70;&#108;&#101;&#46;&#99;&#111;&#109;</a>
CommitDate: Sun Apr 19 16:48:33 2015 +0000</p>

<pre><code>add script
</code></pre>

<p>```</p>

<h2>Modify Commit Time</h2>

<p><code>
(master) [~/modify-commit-time] ➟  ./modify_commit_time.sh 9c4c1d0b4499683ab0ba80dd7041b477c0adb2f0 '3 month ago'
Rewrite a2913a7c39977dd3c4f99f8cabc6fae5b3694cb2 (2/2)
Ref 'refs/heads/master' was rewritten
</code></p>

<h2>Result</h2>

<p>```
(master) [~/modify-commit-time] ➟  git log &mdash;pretty=fuller
commit 9552b631000134921a75f173fa7313c1a90cb96e
Author:     dm4 <a href="&#x6d;&#x61;&#x69;&#x6c;&#116;&#x6f;&#58;&#116;&#101;&#115;&#x74;&#64;&#101;&#120;&#97;&#x6d;&#x70;&#108;&#101;&#46;&#99;&#111;&#x6d;">&#116;&#x65;&#115;&#116;&#64;&#101;&#120;&#97;&#x6d;&#x70;&#x6c;&#x65;&#46;&#99;&#x6f;&#109;</a>
AuthorDate: Sun Apr 19 16:48:33 2015 +0000
Commit:     dm4 <a href="&#109;&#x61;&#105;&#x6c;&#x74;&#111;&#x3a;&#x74;&#x65;&#x73;&#x74;&#x40;&#101;&#x78;&#x61;&#109;&#x70;&#x6c;&#101;&#x2e;&#x63;&#111;&#x6d;">&#x74;&#x65;&#115;&#116;&#x40;&#101;&#x78;&#97;&#109;&#112;&#108;&#x65;&#46;&#99;&#x6f;&#x6d;</a>
CommitDate: Sun Apr 19 16:48:33 2015 +0000</p>

<pre><code>add README
</code></pre>

<p>commit 67e6f5a501703e98f8d9711ade8ab3a51775c265
Author:     dm4 <a href="&#x6d;&#97;&#105;&#x6c;&#116;&#x6f;&#58;&#116;&#101;&#x73;&#116;&#x40;&#101;&#120;&#97;&#x6d;&#112;&#108;&#x65;&#x2e;&#99;&#111;&#x6d;">&#x74;&#x65;&#x73;&#116;&#x40;&#x65;&#x78;&#97;&#x6d;&#112;&#108;&#101;&#46;&#x63;&#111;&#x6d;</a>
AuthorDate: Mon Jan 19 16:49:02 2015 +0000
Commit:     dm4 <a href="&#109;&#x61;&#x69;&#x6c;&#x74;&#111;&#58;&#x74;&#101;&#115;&#116;&#x40;&#x65;&#x78;&#x61;&#109;&#112;&#108;&#101;&#x2e;&#99;&#111;&#x6d;">&#x74;&#101;&#x73;&#x74;&#64;&#101;&#x78;&#x61;&#109;&#112;&#x6c;&#101;&#x2e;&#x63;&#111;&#109;</a>
CommitDate: Mon Jan 19 16:49:02 2015 +0000</p>

<pre><code>add script
</code></pre>

<p>```</p>

<p>這裡可以看到雖然只改了 <code>add script</code> 的 commit ，但是連 <code>add README</code> 的 commit id 也變了，這是因為 git 在算 hash 的時候，也會包含 parent 的 commit id ，所以 parent 的 commit id 變了，所有的 child commit id 都會跟著變，這個在寫 script 批次處理的時候需要注意一下。</p>
]]></content>
  </entry>
  
</feed>
